<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DynoSAM: DynoSAM Installation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DynoSAM
   </div>
   <div id="projectbrief">Dynamic Object Smoothing and Mapping for Dynamic SLAM</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">DynoSAM Installation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Prerequisites</h1>
<ul>
<li><a href="https://docs.ros.org/en/kilted/Installation.html">ROS2</a> <blockquote class="doxtable">
<p>&zwj;NOTE: this links to the kilted distribution which used during development. We have also tested on Jazzy for the NVIDIA ORIN </p>
</blockquote>
- <a href="https://github.com/borglab/gtsam">GTSAM</a> &gt;= 4.1</li>
<li><a href="https://github.com/opencv/opencv">OpenCV</a> &gt;= 3.4</li>
<li><a href="https://github.com/MIT-SPARK/opengv">OpenGV</a></li>
<li><a href="http://rpg.ifi.uzh.ch/docs/glog.html">Glog</a>, <a href="https://gflags.github.io/gflags/">Gflags</a></li>
<li><a href="https://github.com/google/googletest/blob/master/googletest/docs/primer.md">Gtest</a> (installed automagically)</li>
<li><a href="https://github.com/MIT-SPARK/config_utilities">config_utilities</a></li>
<li><a href="https://github.com/ACFR-RPG/dynamic_slam_interfaces">dynamic_slam_interfaces</a> (Required by default. Can be optionally made not a requirement. See Insallation instructions below)</li>
</ul>
<p>External dependancies (for visualization) not required for compilation.</p><ul>
<li><a href="https://github.com/ACFR-RPG/rviz_dynamic_slam_plugins">rviz_dynamic_slam_plugins</a> (Plugin to display custom <code>dynamic_slam_interfaces</code> messages which are advertised by default.)</li>
</ul>
<p>GPU acceleration:</p><ul>
<li><a href="https://github.com/NVIDIA/TensorRT">TensorRT</a></li>
<li><a href="https://docs.nvidia.com/cuda/cuda-runtime-api/index.html">CUDA</a></li>
</ul>
<p>are now supported with the new Docker image. This provides support for TensorRT accellerated object-instance segmentation (which is now part of the DynoSAM pipeline) and CUDA acceleration in the front-end. Backwards compatability (i.e no CUDA support) is not currently a priority.</p>
<p>We provide detailed install instructions when using the Docker.</p>
<p>To install natively, install the dependancies as required by docker and build as a ROS2 package.</p>
<h1>Docker Install instructions</h1>
<p>DynoSAM has been tested on <b>x86_64</b> and <b>aarm64</b> (with a NVIDIA ORIN NX) devices using the <a href="../../docker/">two docker files</a> provided. See the <a class="el" href="md_docker_README.html">REAMDE.md</a> for more detail on hardware used etc.</p>
<p>We provide scripts to build and create docker containers to run and develop DynoSAM which is intendend to be mounted within the created container.</p>
<blockquote class="doxtable">
<p>&zwj;NOTE: with the current setup the embedded device only supports ROS Jazzy. The code should compile on either device without modification. </p>
</blockquote>
<h2>Folder Structure</h2>
<p>To DynoSAM code to be changed within the docker environment, we mount the local version of the code within the container. To ensure this happens smoothly please download the DynoSAM code in the following structure</p>
<div class="fragment"><div class="line">dynosam_pkg/</div>
<div class="line">    DynoSAM/</div>
<div class="line">    extras/</div>
<div class="line">        rviz_dynamic_slam_plugins</div>
<div class="line">        dynamic_slam_interfaces</div>
<div class="line">    results/</div>
</div><!-- fragment --><p> where DynoSAM is this repository and anything in <code>extras</code> are other ROS packages that wish to be built alongside DynoSAM.</p>
<blockquote class="doxtable">
<p>&zwj;NOTE: &lsquo;dynosam_pkg&rsquo; may be any folder, its just a place to put all the DynoSAM related code. </p>
</blockquote>
<blockquote class="doxtable">
<p>&zwj;NOTE: the reason for this structure is historical and due to the way the <em>create_container</em> scripts are written; you don't need to do this but I provide complete instructures for simplicity. </p>
</blockquote>
<h2>Docker Build</h2>
<p>Build the relevant docker file: </p><div class="fragment"><div class="line">cd dynosam_pkg/DynoSAM/docker &amp;&amp;</div>
<div class="line">./build_docker_amd64.sh //or build_docker_l4t.sh</div>
</div><!-- fragment --> <h2>Create Container</h2>
<p>Once built, you should have a docker image called <code>acfr_rpg/dyno_sam_cuda</code> or <code>acfr_rpg/dynosam_cuda_l4t</code></p>
<p>In the associated <em>create_container</em> scripts modify the local variables to match the folder paths on the local machine. These folders will be mounted as a volume within the container </p><div class="fragment"><div class="line">LOCAL_DATA_FOLDER=/path/to/some/datasets/</div>
<div class="line">LOCAL_RESULTS_FOLDER=/path/to/dynosam_pkg/results/</div>
<div class="line">LOCAL_DYNO_SAM_FOLDER=/path/to/dynosam_pkg/DynoSAM/</div>
<div class="line">LOCAL_THIRD_PARTY_DYNO_SAM_FOLDER=/path/to/dynosam_pkg/extras</div>
</div><!-- fragment --><p> Run the creation script. The created container will be called <code>dyno_sam</code> </p><div class="fragment"><div class="line">./create_container_amd64.sh //or ./create_container_l4t_jetpack6.sh</div>
</div><!-- fragment --><p>Finally enter into the container and build DynoSAM </p><div class="fragment"><div class="line">cd /home/user/dev_w &amp;&amp;</div>
<div class="line">export MAKEFLAGS=&quot;-j10&quot; &amp;&amp; clear &amp;&amp; colcon build</div>
</div><!-- fragment --><h1>CUDA dependancies</h1>
<p>As of September 2025 we are adding cuda dependancies for certain OpenCV operations (and evenautually for running inference on images).</p>
<blockquote class="doxtable">
<p>&zwj;NOTE: I have a very old GPU (RTX 2080 which is only running CUDA 12.2 with Driver Version: 535.183.01), get CUDA support however you are able! </p>
</blockquote>
<p>The docker file has been updated and based off the <a href="https://github.com/ika-rwth-aachen/docker-ros-ml-images?tab=readme-ov-file#rwthikaros2-torch-ros-2-nvidia-cuda-nvidia-tensorrt-pytorch">docker-ros-ml-images</a> to include</p><ul>
<li>CUDA</li>
<li>TensorRT</li>
<li>Pytorch built ontop of ROS2.</li>
</ul>
<p>The CUDA dependancies are mostly for OpenCV modules but also eventually for adding DNN inference into DynoSAM itself so processing of images can be handled internally (ie YOLO).</p>
<ul>
<li><b>Important:</b> Check <a href="https://developer.nvidia.com/cuda-gpus">GPU Compute Capability</a> to set <code>CUDA_ARCH_BIN</code> flag</li>
<li>NVIDIA GeForce RTX 2080 is 7.5</li>
</ul>
<h1>Additional Installation Notes</h1>
<p><code>dynamic_slam_interfaces</code> is a require dependacy by default. This package is used to include custom messages that represet the state of each dynamic object per frame and is used by the ROS publishers.</p>
<p>To disable this dependancy compile the code as </p><div class="fragment"><div class="line">colcon build --cmake-args -DENABLE_DYNAMIC_SLAM_INTERFACES=OFF</div>
</div><!-- fragment --><p> By default <code>ENABLE_DYNAMIC_SLAM_INTERFACES=ON</code> in the <a href="./dynosam_ros/CMakeLists.txt">CMakeLists.txt</a>. This CMake option will additionally change the <em>visualisation</em> (and the output topics) used by DynoSAM. See the ROS Visualisation section below.</p>
<p>Due to DynoSAM being build within ROS:</p><ul>
<li>Need to build GTSAM with <code>-DGTSAM_USE_SYSTEM_EIGEN=ON</code> to avoid issues with ROS and OpenCV-Eigen compatability. Confirmed from <a href="https://discourse.ros.org/t/announcing-gtsam-as-a-ros-1-2-package/32739">https://discourse.ros.org/t/announcing-gtsam-as-a-ros-1-2-package/32739</a> which explains that the GTSAM ROS package is build with this flag set to ON (and describes it as "problematic"). We still want to build GTSAM from source so we can control the version and other compiler flags. Kimera-VIO's install instructions indicate that OpenGV must use the same version of Eigen as GTSAM, which can be set using compiler flags. Since we are using the ROS install Eigen, I have removed these flags and hope that the package manager with CMake can find the right (and only) version. This has not proved problematic... yet...</li>
</ul>
<h1>Possible Compilation Issues</h1>
<h2>Missing MPI Header Error</h2>
<p>When first compiling DynoSAM, this error may appear as MPI relies on a non-existent directory. This issue <em>should</em> be fixed a patch in the <code>dynosam_common</code> CMakeLists.txt which directly updates the <code>MPI_INCLUDE_PATH</code>.</p>
<p>However, if the issue persists, the following is a known fix.</p><ol type="1">
<li>Unset HPC-X variables <div class="fragment"><div class="line">unset OPENMPI_VERSION</div>
<div class="line">unset OMPI_MCA_coll_hcoll_enable</div>
<div class="line">unset OPAL_PREFIX</div>
<div class="line">export PATH=$(echo $PATH | tr &#39;:&#39; &#39;\n&#39; | grep -v &#39;/opt/hpcx&#39; | grep -v &#39;/usr/local/mpi/bin&#39; | paste -sd:)</div>
</div><!-- fragment --> Now verify <code>env | grep -i mpi echo $PATH</code> that the <code>OPAL_PREFIX</code> and HPC-X paths no longer appear</li>
<li>Install OpenMPI <div class="fragment"><div class="line">sudo apt update</div>
<div class="line">sudo apt install libopenmpi-dev openmpi-bin</div>
</div><!-- fragment --> and verify that the following points to <code>/usr/bin/mpicc</code> <div class="fragment"><div class="line">which mpicc</div>
<div class="line">mpicc --version</div>
</div><!-- fragment --></li>
<li>Clear the ROS2 workspace <div class="fragment"><div class="line">rm -rf build/ install/ log/</div>
</div><!-- fragment --></li>
<li>Build with the system MPI <div class="fragment"><div class="line">export MPI_C_COMPILER=/usr/bin/mpicc</div>
<div class="line">export MPI_CXX_COMPILER=/usr/bin/mpicxx</div>
<div class="line">colcon build</div>
</div><!-- fragment --> <h2>Missing Dependencies</h2>
</li>
</ol>
<ul>
<li><code>nlohmannjson</code> may not be installed, so install with <code>sudo apt install nlohmann-json3-dev</code></li>
<li>GTSAM may not be installed, so install with <code>pip install gtsam</code> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
