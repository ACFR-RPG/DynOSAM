<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DynoSAM: dyno::OpticalFlowAndPoseOptimizer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DynoSAM
   </div>
   <div id="projectbrief">Dynamic Object Smoothing and Mapping for Dynamic SLAM</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacedyno.html">dyno</a></li><li class="navelem"><a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html">OpticalFlowAndPoseOptimizer</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classdyno_1_1OpticalFlowAndPoseOptimizer-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">dyno::OpticalFlowAndPoseOptimizer Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Joinly refines optical flow with with the given pose using the error term: e = [u,v]_{k_1} + f_{k-1, k} - \pi(X^{-1} \: m_k) where f is flow, [u,v]_{k-1} is the observed keypoint at k-1, X is the pose and m_k is the back-projected keypoint at k.  
 <a href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="MotionSolver_8hpp_source.html">MotionSolver.hpp</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for dyno::OpticalFlowAndPoseOptimizer:</div>
<div class="dyncontent">
<div class="center"><img src="classdyno_1_1OpticalFlowAndPoseOptimizer__coll__graph.png" border="0" usemap="#adyno_1_1OpticalFlowAndPoseOptimizer_coll__map" alt="Collaboration graph"/></div>
<map name="adyno_1_1OpticalFlowAndPoseOptimizer_coll__map" id="adyno_1_1OpticalFlowAndPoseOptimizer_coll__map">
<area shape="rect" title="Joinly refines optical flow with with the given pose using the error term: e = [u,..." alt="" coords="5,108,200,148"/>
<area shape="rect" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html" title=" " alt="" coords="5,5,200,45"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html">Params</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1ResultType.html">ResultType</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a09e6319df4385bc229ac07b3555d6589"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#a09e6319df4385bc229ac07b3555d6589">Result</a> = <a class="el" href="structdyno_1_1SolverResult.html">SolverResult</a>&lt; <a class="el" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1ResultType.html">ResultType</a> &gt;</td></tr>
<tr class="separator:a09e6319df4385bc229ac07b3555d6589"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ac6f6377b27fd640d547153b1d7ca29eb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#ac6f6377b27fd640d547153b1d7ca29eb">OpticalFlowAndPoseOptimizer</a> (const <a class="el" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html">Params</a> &amp;params)</td></tr>
<tr class="separator:ac6f6377b27fd640d547153b1d7ca29eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ed1443b579b5e4847a00b4a85da81d9"><td class="memTemplParams" colspan="2">template&lt;typename CALIBRATION &gt; </td></tr>
<tr class="memitem:a4ed1443b579b5e4847a00b4a85da81d9"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#a09e6319df4385bc229ac07b3555d6589">Result</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#a4ed1443b579b5e4847a00b4a85da81d9">optimize</a> (const Frame::Ptr frame_k_1, const Frame::Ptr frame_k, const <a class="el" href="namespacedyno.html#a7b74611da938f0d55a3b1fdb16219037">TrackletIds</a> &amp;tracklets, const gtsam::Pose3 &amp;initial_pose) const</td></tr>
<tr class="memdesc:a4ed1443b579b5e4847a00b4a85da81d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Builds the factor-graph problem using the set of specificed correspondences (tracklets) in frame k-1 and k and the initial pose.  <br /></td></tr>
<tr class="separator:a4ed1443b579b5e4847a00b4a85da81d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad96216e768fc5dea6e6411222bac0ddd"><td class="memTemplParams" colspan="2">template&lt;typename CALIBRATION &gt; </td></tr>
<tr class="memitem:ad96216e768fc5dea6e6411222bac0ddd"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#a09e6319df4385bc229ac07b3555d6589">Result</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#ad96216e768fc5dea6e6411222bac0ddd">optimizeAndUpdate</a> (Frame::Ptr frame_k_1, Frame::Ptr frame_k, const <a class="el" href="namespacedyno.html#a7b74611da938f0d55a3b1fdb16219037">TrackletIds</a> &amp;tracklets, const gtsam::Pose3 &amp;initial_pose) const</td></tr>
<tr class="memdesc:ad96216e768fc5dea6e6411222bac0ddd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Builds the factor-graph problem using the set of specificed correspondences (tracklets) in frame k-1 and k and the initial pose. Unlike the optimize only version this also update the features within the frames as outliers after optimisation. It will also update the feature data (depth keypoint etc...) with the refined flows.  <br /></td></tr>
<tr class="separator:ad96216e768fc5dea6e6411222bac0ddd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:af1037c8661213cd6e602b30918b6b3ec"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#af1037c8661213cd6e602b30918b6b3ec">updateFrameOutliersWithResult</a> (const <a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#a09e6319df4385bc229ac07b3555d6589">Result</a> &amp;result, Frame::Ptr frame_k_1, Frame::Ptr frame_k) const</td></tr>
<tr class="separator:af1037c8661213cd6e602b30918b6b3ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:afd94858cb502bb37ae83cb4d482f7d0e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html">Params</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#afd94858cb502bb37ae83cb4d482f7d0e">params_</a></td></tr>
<tr class="separator:afd94858cb502bb37ae83cb4d482f7d0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Joinly refines optical flow with with the given pose using the error term: e = [u,v]_{k_1} + f_{k-1, k} - \pi(X^{-1} \: m_k) where f is flow, [u,v]_{k-1} is the observed keypoint at k-1, X is the pose and m_k is the back-projected keypoint at k. </p>
<p>The parsed tracklets are the set of correspondances with which to build the optimisation problem and the refined inliers will be a subset of these tracklets. THe number of refined flows should be the number of refined inliers and be a 1-to-1 match </p>

<p class="definition">Definition at line <a class="el" href="MotionSolver_8hpp_source.html#l00130">130</a> of file <a class="el" href="MotionSolver_8hpp_source.html">MotionSolver.hpp</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a id="a09e6319df4385bc229ac07b3555d6589" name="a09e6319df4385bc229ac07b3555d6589"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09e6319df4385bc229ac07b3555d6589">&#9670;&#160;</a></span>Result</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#a09e6319df4385bc229ac07b3555d6589">dyno::OpticalFlowAndPoseOptimizer::Result</a> =  <a class="el" href="structdyno_1_1SolverResult.html">SolverResult</a>&lt;<a class="el" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1ResultType.html">ResultType</a>&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MotionSolver_8hpp_source.html#l00149">149</a> of file <a class="el" href="MotionSolver_8hpp_source.html">MotionSolver.hpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ac6f6377b27fd640d547153b1d7ca29eb" name="ac6f6377b27fd640d547153b1d7ca29eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6f6377b27fd640d547153b1d7ca29eb">&#9670;&#160;</a></span>OpticalFlowAndPoseOptimizer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">dyno::OpticalFlowAndPoseOptimizer::OpticalFlowAndPoseOptimizer </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html">Params</a> &amp;&#160;</td>
          <td class="paramname"><em>params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MotionSolver_8hpp_source.html#l00151">151</a> of file <a class="el" href="MotionSolver_8hpp_source.html">MotionSolver.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  151</span>: <a class="code hl_variable" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#afd94858cb502bb37ae83cb4d482f7d0e">params_</a>(params) {}</div>
<div class="ttc" id="aclassdyno_1_1OpticalFlowAndPoseOptimizer_html_afd94858cb502bb37ae83cb4d482f7d0e"><div class="ttname"><a href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#afd94858cb502bb37ae83cb4d482f7d0e">dyno::OpticalFlowAndPoseOptimizer::params_</a></div><div class="ttdeci">Params params_</div><div class="ttdef"><b>Definition:</b> <a href="MotionSolver_8hpp_source.html#l00210">MotionSolver.hpp:210</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a4ed1443b579b5e4847a00b4a85da81d9" name="a4ed1443b579b5e4847a00b4a85da81d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ed1443b579b5e4847a00b4a85da81d9">&#9670;&#160;</a></span>optimize()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename CALIBRATION &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#a09e6319df4385bc229ac07b3555d6589">OpticalFlowAndPoseOptimizer::Result</a> dyno::OpticalFlowAndPoseOptimizer::optimize </td>
          <td>(</td>
          <td class="paramtype">const Frame::Ptr&#160;</td>
          <td class="paramname"><em>frame_k_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Frame::Ptr&#160;</td>
          <td class="paramname"><em>frame_k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacedyno.html#a7b74611da938f0d55a3b1fdb16219037">TrackletIds</a> &amp;&#160;</td>
          <td class="paramname"><em>tracklets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gtsam::Pose3 &amp;&#160;</td>
          <td class="paramname"><em>initial_pose</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Builds the factor-graph problem using the set of specificed correspondences (tracklets) in frame k-1 and k and the initial pose. </p>
<p>The optimisation joinly refines optical flow with with the given pose using the error term: e = [u,v]_{k_1} + f_{k-1, k} - \pi(X^{-1} \: m_k) where f is flow, [u,v]_{k-1} is the observed keypoint at k-1, X is the pose and m_k is the back-projected keypoint at k.</p>
<p>The parsed tracklets are the set of correspondances with which to build the optimisation problem and the refined inliers will be a subset of these tracklets. THe number of refined flows should be the number of refined inliers and be a 1-to-1 match</p>
<p>This is agnostic to if the problem is solving for a motion or a pose so the user must make sure the initial pose is in the right form.</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">CALIBRATION</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">frame_k_1</td><td></td></tr>
    <tr><td class="paramname">frame_k</td><td></td></tr>
    <tr><td class="paramname">tracklets</td><td></td></tr>
    <tr><td class="paramname">initial_pose</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Result </dd></dl>

<p class="definition">Definition at line <a class="el" href="MotionSolver-inl_8hpp_source.html#l00090">90</a> of file <a class="el" href="MotionSolver-inl_8hpp_source.html">MotionSolver-inl.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   92</span>                                                                        {</div>
<div class="line"><span class="lineno">   93</span>  utils::TimingStatsCollector timer(<span class="stringliteral">&quot;of_motion_solver.optimize&quot;</span>);</div>
<div class="line"><span class="lineno">   94</span> </div>
<div class="line"><span class="lineno">   95</span>  <span class="keyword">using </span>Calibration = CALIBRATION;</div>
<div class="line"><span class="lineno">   96</span>  <span class="keyword">using </span>Pose3FlowProjectionFactorCalib = Pose3FlowProjectionFactor&lt;Calibration&gt;;</div>
<div class="line"><span class="lineno">   97</span> </div>
<div class="line"><span class="lineno">   98</span>  gtsam::NonlinearFactorGraph graph;</div>
<div class="line"><span class="lineno">   99</span>  gtsam::Values values;</div>
<div class="line"><span class="lineno">  100</span> </div>
<div class="line"><span class="lineno">  101</span>  gtsam::SharedNoiseModel flow_noise =</div>
<div class="line"><span class="lineno">  102</span>      gtsam::noiseModel::Isotropic::Sigma(2u, <a class="code hl_variable" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#afd94858cb502bb37ae83cb4d482f7d0e">params_</a>.<a class="code hl_variable" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html#a3d8f270eb76364610027ab5a466334ac">flow_sigma</a>);</div>
<div class="line"><span class="lineno">  103</span> </div>
<div class="line"><span class="lineno">  104</span>  gtsam::SharedNoiseModel flow_prior_noise =</div>
<div class="line"><span class="lineno">  105</span>      gtsam::noiseModel::Isotropic::Sigma(2u, <a class="code hl_variable" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#afd94858cb502bb37ae83cb4d482f7d0e">params_</a>.<a class="code hl_variable" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html#a679c707ed2f40d369c7292ce94537d2f">flow_prior_sigma</a>);</div>
<div class="line"><span class="lineno">  106</span> </div>
<div class="line"><span class="lineno">  107</span>  <span class="comment">// robust noise model!</span></div>
<div class="line"><span class="lineno">  108</span>  flow_noise = gtsam::noiseModel::Robust::Create(</div>
<div class="line"><span class="lineno">  109</span>      gtsam::noiseModel::mEstimator::Huber::Create(<a class="code hl_variable" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#afd94858cb502bb37ae83cb4d482f7d0e">params_</a>.<a class="code hl_variable" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html#abad2967ead84f407fe0652b9193120da">k_huber</a>),</div>
<div class="line"><span class="lineno">  110</span>      flow_noise);</div>
<div class="line"><span class="lineno">  111</span> </div>
<div class="line"><span class="lineno">  112</span>  <span class="keyword">const</span> gtsam::Pose3 T_world_k_1 = frame_k_1-&gt;getPose();</div>
<div class="line"><span class="lineno">  113</span>  <span class="keyword">const</span> gtsam::Symbol pose_key(<span class="charliteral">&#39;X&#39;</span>, 0);</div>
<div class="line"><span class="lineno">  114</span> </div>
<div class="line"><span class="lineno">  115</span>  gtsam::Ordering ordering;</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>  <span class="comment">// lambda to construct gtsam symbol from a tracklet</span></div>
<div class="line"><span class="lineno">  118</span>  <span class="keyword">auto</span> flowSymbol = [](<a class="code hl_typedef" href="namespacedyno.html#afdd174eb44901fb205371d796287378c">TrackletId</a> tracklet) -&gt; gtsam::Symbol {</div>
<div class="line"><span class="lineno">  119</span>    <span class="keywordflow">return</span> gtsam::symbol_shorthand::F(<span class="keyword">static_cast&lt;</span>uint64_t<span class="keyword">&gt;</span>(tracklet));</div>
<div class="line"><span class="lineno">  120</span>  };</div>
<div class="line"><span class="lineno">  121</span>  <span class="keyword">auto</span> gtsam_calibration = boost::make_shared&lt;Calibration&gt;(</div>
<div class="line"><span class="lineno">  122</span>      frame_k_1-&gt;getFrameCamera().calibration());</div>
<div class="line"><span class="lineno">  123</span> </div>
<div class="line"><span class="lineno">  124</span>  <span class="comment">// sanity check to ensure all tracklets are on the same object</span></div>
<div class="line"><span class="lineno">  125</span>  std::unordered_set&lt;ObjectId&gt; object_id;</div>
<div class="line"><span class="lineno">  126</span> </div>
<div class="line"><span class="lineno">  127</span>  <span class="keywordflow">for</span> (<a class="code hl_typedef" href="namespacedyno.html#afdd174eb44901fb205371d796287378c">TrackletId</a> tracklet_id : tracklets) {</div>
<div class="line"><span class="lineno">  128</span>    Feature::Ptr feature_k_1 = frame_k_1-&gt;at(tracklet_id);</div>
<div class="line"><span class="lineno">  129</span>    Feature::Ptr feature_k = frame_k-&gt;at(tracklet_id);</div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>    object_id.insert(feature_k_1-&gt;objectId());</div>
<div class="line"><span class="lineno">  132</span>    object_id.insert(feature_k-&gt;objectId());</div>
<div class="line"><span class="lineno">  133</span> </div>
<div class="line"><span class="lineno">  134</span>    CHECK_NOTNULL(feature_k_1);</div>
<div class="line"><span class="lineno">  135</span>    CHECK_NOTNULL(feature_k);</div>
<div class="line"><span class="lineno">  136</span> </div>
<div class="line"><span class="lineno">  137</span>    CHECK(feature_k_1-&gt;hasDepth());</div>
<div class="line"><span class="lineno">  138</span>    CHECK(feature_k-&gt;hasDepth())</div>
<div class="line"><span class="lineno">  139</span>        &lt;&lt; <span class="stringliteral">&quot; with object id &quot;</span> &lt;&lt; feature_k-&gt;objectId() &lt;&lt; <span class="stringliteral">&quot; and is valid &quot;</span></div>
<div class="line"><span class="lineno">  140</span>        &lt;&lt; feature_k-&gt;usable() &lt;&lt; <span class="stringliteral">&quot; and age &quot;</span> &lt;&lt; feature_k-&gt;age()</div>
<div class="line"><span class="lineno">  141</span>        &lt;&lt; <span class="stringliteral">&quot; previous age &quot;</span> &lt;&lt; feature_k_1-&gt;age() &lt;&lt; <span class="stringliteral">&quot; kp &quot;</span></div>
<div class="line"><span class="lineno">  142</span>        &lt;&lt; feature_k-&gt;keypoint();</div>
<div class="line"><span class="lineno">  143</span> </div>
<div class="line"><span class="lineno">  144</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="namespacedyno.html#aaa260a8022691078c59e1ac6a4fa05b5">Keypoint</a> kp_k_1 = feature_k_1-&gt;keypoint();</div>
<div class="line"><span class="lineno">  145</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="namespacedyno.html#a6154f8a946fc0fe72c0286a45ed9d51d">Depth</a> depth_k_1 = feature_k_1-&gt;depth();</div>
<div class="line"><span class="lineno">  146</span> </div>
<div class="line"><span class="lineno">  147</span>    <span class="keyword">const</span> gtsam::Point2 flow = feature_k_1-&gt;measuredFlow();</div>
<div class="line"><span class="lineno">  148</span>    CHECK(gtsam::equal(kp_k_1 + flow, feature_k-&gt;keypoint()))</div>
<div class="line"><span class="lineno">  149</span>        &lt;&lt; gtsam::Point2(kp_k_1 + flow) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; feature_k-&gt;keypoint()</div>
<div class="line"><span class="lineno">  150</span>        &lt;&lt; <span class="stringliteral">&quot; object id &quot;</span> &lt;&lt; feature_k-&gt;objectId() &lt;&lt; <span class="stringliteral">&quot; flow &quot;</span> &lt;&lt; flow;</div>
<div class="line"><span class="lineno">  151</span> </div>
<div class="line"><span class="lineno">  152</span>    gtsam::Symbol flow_symbol(flowSymbol(tracklet_id));</div>
<div class="line"><span class="lineno">  153</span>    <span class="keyword">auto</span> flow_factor = boost::make_shared&lt;Pose3FlowProjectionFactorCalib&gt;(</div>
<div class="line"><span class="lineno">  154</span>        flow_symbol, pose_key, kp_k_1, depth_k_1, T_world_k_1,</div>
<div class="line"><span class="lineno">  155</span>        *gtsam_calibration, flow_noise);</div>
<div class="line"><span class="lineno">  156</span>    graph.add(flow_factor);</div>
<div class="line"><span class="lineno">  157</span> </div>
<div class="line"><span class="lineno">  158</span>    <span class="comment">// add prior factor on each flow</span></div>
<div class="line"><span class="lineno">  159</span>    graph.addPrior&lt;gtsam::Point2&gt;(flow_symbol, flow, flow_prior_noise);</div>
<div class="line"><span class="lineno">  160</span> </div>
<div class="line"><span class="lineno">  161</span>    values.insert(flow_symbol, flow);</div>
<div class="line"><span class="lineno">  162</span>    ordering += flow_symbol;</div>
<div class="line"><span class="lineno">  163</span>  }</div>
<div class="line"><span class="lineno">  164</span> </div>
<div class="line"><span class="lineno">  165</span>  <span class="comment">// pose at frame k</span></div>
<div class="line"><span class="lineno">  166</span>  <span class="comment">// put pose last and use custom ordering!</span></div>
<div class="line"><span class="lineno">  167</span>  values.insert(pose_key, initial_pose);</div>
<div class="line"><span class="lineno">  168</span>  ordering += pose_key;</div>
<div class="line"><span class="lineno">  169</span> </div>
<div class="line"><span class="lineno">  170</span>  <span class="comment">// check we only have one label</span></div>
<div class="line"><span class="lineno">  171</span>  CHECK_EQ(object_id.size(), 1u);</div>
<div class="line"><span class="lineno">  172</span>  <a class="code hl_typedef" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#a09e6319df4385bc229ac07b3555d6589">Result</a> result;</div>
<div class="line"><span class="lineno">  173</span>  result.best_result.object_id = *object_id.begin();</div>
<div class="line"><span class="lineno">  174</span> </div>
<div class="line"><span class="lineno">  175</span>  <span class="comment">// double error_before = graph.error(values);</span></div>
<div class="line"><span class="lineno">  176</span>  std::vector&lt;double&gt; post_errors;</div>
<div class="line"><span class="lineno">  177</span>  std::unordered_set&lt;gtsam::Key&gt; outlier_flows;</div>
<div class="line"><span class="lineno">  178</span>  <span class="comment">// graph we will mutate by removing outlier factors</span></div>
<div class="line"><span class="lineno">  179</span>  gtsam::NonlinearFactorGraph mutable_graph = graph;</div>
<div class="line"><span class="lineno">  180</span>  gtsam::Values optimised_values = values;</div>
<div class="line"><span class="lineno">  181</span>  <span class="comment">// number of all variables</span></div>
<div class="line"><span class="lineno">  182</span>  <a class="code hl_typedef" href="namespacedyno_1_1utils.html#a2a0bf9b09c753fdfa86ae7ebb92a0746">utils::StatsCollector</a>(<span class="stringliteral">&quot;of_motion_solver.joint_of_pose_num_vars_all&quot;</span>)</div>
<div class="line"><span class="lineno">  183</span>      .<a class="code hl_function" href="classdyno_1_1utils_1_1StatsCollectorImpl.html#ab92087ce27dbec18730bf779e48d6aec">AddSample</a>(optimised_values.size());</div>
<div class="line"><span class="lineno">  184</span> </div>
<div class="line"><span class="lineno">  185</span>  gtsam::LevenbergMarquardtParams opt_params;</div>
<div class="line"><span class="lineno">  186</span>  <span class="comment">// for speed</span></div>
<div class="line"><span class="lineno">  187</span>  opt_params.setMaxIterations(10);</div>
<div class="line"><span class="lineno">  188</span>  <span class="comment">// this is basically a set of prior looking factors on a pose so we know we</span></div>
<div class="line"><span class="lineno">  189</span>  <span class="comment">// need to eliminate the pose last to avoid fill in therefore we use our own</span></div>
<div class="line"><span class="lineno">  190</span>  <span class="comment">// custom ordering that has the pose last</span></div>
<div class="line"><span class="lineno">  191</span>  <span class="comment">// opt_params.setOrdering(ordering);</span></div>
<div class="line"><span class="lineno">  192</span>  <span class="keywordflow">if</span> (VLOG_IS_ON(200))</div>
<div class="line"><span class="lineno">  193</span>    opt_params.verbosity = gtsam::NonlinearOptimizerParams::Verbosity::ERROR;</div>
<div class="line"><span class="lineno">  194</span> </div>
<div class="line"><span class="lineno">  195</span>  {</div>
<div class="line"><span class="lineno">  196</span>    utils::TimingStatsCollector timer(<span class="stringliteral">&quot;of_motion_solver.LM_solve&quot;</span>);</div>
<div class="line"><span class="lineno">  197</span>    optimised_values = gtsam::LevenbergMarquardtOptimizer(</div>
<div class="line"><span class="lineno">  198</span>                           mutable_graph, optimised_values, opt_params)</div>
<div class="line"><span class="lineno">  199</span>                           .optimize();</div>
<div class="line"><span class="lineno">  200</span>  }</div>
<div class="line"><span class="lineno">  201</span>  <span class="comment">// double error_after = mutable_graph.error(optimised_values);</span></div>
<div class="line"><span class="lineno">  202</span>  <span class="comment">// post_errors.push_back(error_after);</span></div>
<div class="line"><span class="lineno">  203</span> </div>
<div class="line"><span class="lineno">  204</span>  gtsam::FactorIndices outlier_factors;</div>
<div class="line"><span class="lineno">  205</span>  <span class="comment">// if we have outliers, enter iteration loop</span></div>
<div class="line"><span class="lineno">  206</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#afd94858cb502bb37ae83cb4d482f7d0e">params_</a>.<a class="code hl_variable" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html#a76b47510da87424e5eefdfee9d22e79c">outlier_reject</a>) {</div>
<div class="line"><span class="lineno">  207</span>    utils::TimingStatsCollector timer(<span class="stringliteral">&quot;of_motion_solver.outlier_reject&quot;</span>);</div>
<div class="line"><span class="lineno">  208</span> </div>
<div class="line"><span class="lineno">  209</span>    outlier_factors = <a class="code hl_function" href="namespacedyno_1_1factor__graph__tools.html#af7b6cb76226919a10ad3cdac2ba3ac6a">factor_graph_tools::determineFactorOutliers</a>&lt;</div>
<div class="line"><span class="lineno">  210</span>        Pose3FlowProjectionFactorCalib&gt;(mutable_graph, optimised_values);</div>
<div class="line"><span class="lineno">  211</span> </div>
<div class="line"><span class="lineno">  212</span>    <span class="keywordflow">if</span> (outlier_factors.size() &gt; 0) {</div>
<div class="line"><span class="lineno">  213</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> itr = 0; itr &lt; 4; itr++) {</div>
<div class="line"><span class="lineno">  214</span>        <span class="comment">// currently removing factors from graph makes them nullptr</span></div>
<div class="line"><span class="lineno">  215</span>        gtsam::NonlinearFactorGraph mutable_graph_with_null = mutable_graph;</div>
<div class="line"><span class="lineno">  216</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> outlier_idx : outlier_factors) {</div>
<div class="line"><span class="lineno">  217</span>          <span class="keyword">auto</span> factor = mutable_graph_with_null.at(outlier_idx);</div>
<div class="line"><span class="lineno">  218</span>          gtsam::Symbol flow_symbol = factor-&gt;keys()[0];</div>
<div class="line"><span class="lineno">  219</span>          CHECK_EQ(flow_symbol.chr(), <span class="charliteral">&#39;f&#39;</span>);</div>
<div class="line"><span class="lineno">  220</span> </div>
<div class="line"><span class="lineno">  221</span>          outlier_flows.insert(flow_symbol.key());</div>
<div class="line"><span class="lineno">  222</span>          mutable_graph_with_null.remove(outlier_idx);</div>
<div class="line"><span class="lineno">  223</span>        }</div>
<div class="line"><span class="lineno">  224</span>        <span class="comment">// now iterate over graph and add factors that are not null to ensure</span></div>
<div class="line"><span class="lineno">  225</span>        <span class="comment">// all factors are ok</span></div>
<div class="line"><span class="lineno">  226</span>        mutable_graph.resize(0);</div>
<div class="line"><span class="lineno">  227</span>        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; mutable_graph_with_null.size(); i++) {</div>
<div class="line"><span class="lineno">  228</span>          <span class="keyword">auto</span> factor = mutable_graph_with_null.at(i);</div>
<div class="line"><span class="lineno">  229</span>          <span class="keywordflow">if</span> (factor) {</div>
<div class="line"><span class="lineno">  230</span>            mutable_graph.add(factor);</div>
<div class="line"><span class="lineno">  231</span>          }</div>
<div class="line"><span class="lineno">  232</span>        }</div>
<div class="line"><span class="lineno">  233</span> </div>
<div class="line"><span class="lineno">  234</span>        optimised_values.update(pose_key, initial_pose);</div>
<div class="line"><span class="lineno">  235</span>        <span class="comment">// do we use values or optimised values here?</span></div>
<div class="line"><span class="lineno">  236</span>        optimised_values = gtsam::LevenbergMarquardtOptimizer(</div>
<div class="line"><span class="lineno">  237</span>                               mutable_graph, optimised_values, opt_params)</div>
<div class="line"><span class="lineno">  238</span>                               .optimize();</div>
<div class="line"><span class="lineno">  239</span>        <span class="comment">// error_after = mutable_graph.error(optimised_values);</span></div>
<div class="line"><span class="lineno">  240</span>        <span class="comment">// post_errors.push_back(error_after);</span></div>
<div class="line"><span class="lineno">  241</span> </div>
<div class="line"><span class="lineno">  242</span>        outlier_factors = <a class="code hl_function" href="namespacedyno_1_1factor__graph__tools.html#af7b6cb76226919a10ad3cdac2ba3ac6a">factor_graph_tools::determineFactorOutliers</a>&lt;</div>
<div class="line"><span class="lineno">  243</span>            Pose3FlowProjectionFactorCalib&gt;(mutable_graph, optimised_values);</div>
<div class="line"><span class="lineno">  244</span> </div>
<div class="line"><span class="lineno">  245</span>        <span class="keywordflow">if</span> (outlier_factors.size() == 0) {</div>
<div class="line"><span class="lineno">  246</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  247</span>        }</div>
<div class="line"><span class="lineno">  248</span>      }</div>
<div class="line"><span class="lineno">  249</span>    }</div>
<div class="line"><span class="lineno">  250</span>  }</div>
<div class="line"><span class="lineno">  251</span> </div>
<div class="line"><span class="lineno">  252</span>  <span class="comment">// size_t initial_size = graph.size();</span></div>
<div class="line"><span class="lineno">  253</span>  <span class="comment">// size_t inlier_size = mutable_graph.size();</span></div>
<div class="line"><span class="lineno">  254</span>  <span class="comment">// error_after = mutable_graph.error(optimised_values);</span></div>
<div class="line"><span class="lineno">  255</span> </div>
<div class="line"><span class="lineno">  256</span>  <span class="comment">// recover values</span></div>
<div class="line"><span class="lineno">  257</span>  result.best_result.refined_pose = optimised_values.at&lt;gtsam::Pose3&gt;(pose_key);</div>
<div class="line"><span class="lineno">  258</span>  <span class="comment">// result.error_before = error_before;</span></div>
<div class="line"><span class="lineno">  259</span>  <span class="comment">// result.error_after = error_after;</span></div>
<div class="line"><span class="lineno">  260</span> </div>
<div class="line"><span class="lineno">  261</span>  <span class="comment">// for each outlier edge, update the set of inliers</span></div>
<div class="line"><span class="lineno">  262</span>  <span class="keywordflow">for</span> (<a class="code hl_typedef" href="namespacedyno.html#afdd174eb44901fb205371d796287378c">TrackletId</a> tracklet_id : tracklets) {</div>
<div class="line"><span class="lineno">  263</span>    <span class="keyword">const</span> gtsam::Symbol flow_sym = flowSymbol(tracklet_id);</div>
<div class="line"><span class="lineno">  264</span>    <span class="keyword">const</span> gtsam::Key flow_key = flow_sym.key();</div>
<div class="line"><span class="lineno">  265</span> </div>
<div class="line"><span class="lineno">  266</span>    <span class="keywordflow">if</span> (outlier_flows.find(flow_key) != outlier_flows.end()) {</div>
<div class="line"><span class="lineno">  267</span>      <span class="comment">// still need to update the result as this is used to actually update the</span></div>
<div class="line"><span class="lineno">  268</span>      <span class="comment">// outlier tracklets in the updateFrameOutliersWithResult</span></div>
<div class="line"><span class="lineno">  269</span>      result.outliers.push_back(tracklet_id);</div>
<div class="line"><span class="lineno">  270</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  271</span>      gtsam::Point2 refined_flow = optimised_values.at&lt;gtsam::Point2&gt;(flow_sym);</div>
<div class="line"><span class="lineno">  272</span>      result.best_result.refined_flows.push_back(refined_flow);</div>
<div class="line"><span class="lineno">  273</span>      result.inliers.push_back(tracklet_id);</div>
<div class="line"><span class="lineno">  274</span>    }</div>
<div class="line"><span class="lineno">  275</span>  }</div>
<div class="line"><span class="lineno">  276</span>  <span class="comment">// number of variables after outlier removal</span></div>
<div class="line"><span class="lineno">  277</span>  <a class="code hl_typedef" href="namespacedyno_1_1utils.html#a2a0bf9b09c753fdfa86ae7ebb92a0746">utils::StatsCollector</a>(<span class="stringliteral">&quot;of_motion_solver.joint_of_pose_num_vars_inliers&quot;</span>)</div>
<div class="line"><span class="lineno">  278</span>      .<a class="code hl_function" href="classdyno_1_1utils_1_1StatsCollectorImpl.html#ab92087ce27dbec18730bf779e48d6aec">AddSample</a>(result.inliers.size());</div>
<div class="line"><span class="lineno">  279</span> </div>
<div class="line"><span class="lineno">  280</span>  CHECK_EQ(tracklets.size(), result.inliers.size() + result.outliers.size());</div>
<div class="line"><span class="lineno">  281</span>  <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  282</span>}</div>
<div class="ttc" id="aclassdyno_1_1OpticalFlowAndPoseOptimizer_html_a09e6319df4385bc229ac07b3555d6589"><div class="ttname"><a href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#a09e6319df4385bc229ac07b3555d6589">dyno::OpticalFlowAndPoseOptimizer::Result</a></div><div class="ttdeci">SolverResult&lt; ResultType &gt; Result</div><div class="ttdef"><b>Definition:</b> <a href="MotionSolver_8hpp_source.html#l00149">MotionSolver.hpp:149</a></div></div>
<div class="ttc" id="aclassdyno_1_1utils_1_1StatsCollectorImpl_html_ab92087ce27dbec18730bf779e48d6aec"><div class="ttname"><a href="classdyno_1_1utils_1_1StatsCollectorImpl.html#ab92087ce27dbec18730bf779e48d6aec">dyno::utils::StatsCollectorImpl::AddSample</a></div><div class="ttdeci">void AddSample(double sample) const</div><div class="ttdef"><b>Definition:</b> <a href="Statistics_8cc_source.html#l00133">Statistics.cc:133</a></div></div>
<div class="ttc" id="anamespacedyno_1_1factor__graph__tools_html_af7b6cb76226919a10ad3cdac2ba3ac6a"><div class="ttname"><a href="namespacedyno_1_1factor__graph__tools.html#af7b6cb76226919a10ad3cdac2ba3ac6a">dyno::factor_graph_tools::determineFactorOutliers</a></div><div class="ttdeci">gtsam::FactorIndices determineFactorOutliers(const gtsam::NonlinearFactorGraph &amp;graph, const gtsam::Values &amp;values, double confidence=0.99)</div><div class="ttdef"><b>Definition:</b> <a href="FactorGraphTools_8hpp_source.html#l00075">FactorGraphTools.hpp:75</a></div></div>
<div class="ttc" id="anamespacedyno_1_1utils_html_a2a0bf9b09c753fdfa86ae7ebb92a0746"><div class="ttname"><a href="namespacedyno_1_1utils.html#a2a0bf9b09c753fdfa86ae7ebb92a0746">dyno::utils::StatsCollector</a></div><div class="ttdeci">StatsCollectorImpl StatsCollector</div><div class="ttdef"><b>Definition:</b> <a href="Statistics_8hpp_source.html#l00305">Statistics.hpp:305</a></div></div>
<div class="ttc" id="anamespacedyno_html_a6154f8a946fc0fe72c0286a45ed9d51d"><div class="ttname"><a href="namespacedyno.html#a6154f8a946fc0fe72c0286a45ed9d51d">dyno::Depth</a></div><div class="ttdeci">double Depth</div><div class="ttdef"><b>Definition:</b> <a href="Types_8hpp_source.html#l00077">Types.hpp:77</a></div></div>
<div class="ttc" id="anamespacedyno_html_aaa260a8022691078c59e1ac6a4fa05b5"><div class="ttname"><a href="namespacedyno.html#aaa260a8022691078c59e1ac6a4fa05b5">dyno::Keypoint</a></div><div class="ttdeci">gtsam::Point2 Keypoint</div><div class="ttdoc">Observed optical flow vector (ordered x, y)</div><div class="ttdef"><b>Definition:</b> <a href="Types_8hpp_source.html#l00096">Types.hpp:96</a></div></div>
<div class="ttc" id="anamespacedyno_html_afdd174eb44901fb205371d796287378c"><div class="ttname"><a href="namespacedyno.html#afdd174eb44901fb205371d796287378c">dyno::TrackletId</a></div><div class="ttdeci">long int TrackletId</div><div class="ttdoc">Unique tracklet/landmark id, i.</div><div class="ttdef"><b>Definition:</b> <a href="Types_8hpp_source.html#l00081">Types.hpp:81</a></div></div>
<div class="ttc" id="astructdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params_html_a3d8f270eb76364610027ab5a466334ac"><div class="ttname"><a href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html#a3d8f270eb76364610027ab5a466334ac">dyno::OpticalFlowAndPoseOptimizer::Params::flow_sigma</a></div><div class="ttdeci">double flow_sigma</div><div class="ttdef"><b>Definition:</b> <a href="MotionSolver_8hpp_source.html#l00133">MotionSolver.hpp:133</a></div></div>
<div class="ttc" id="astructdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params_html_a679c707ed2f40d369c7292ce94537d2f"><div class="ttname"><a href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html#a679c707ed2f40d369c7292ce94537d2f">dyno::OpticalFlowAndPoseOptimizer::Params::flow_prior_sigma</a></div><div class="ttdeci">double flow_prior_sigma</div><div class="ttdef"><b>Definition:</b> <a href="MotionSolver_8hpp_source.html#l00134">MotionSolver.hpp:134</a></div></div>
<div class="ttc" id="astructdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params_html_a76b47510da87424e5eefdfee9d22e79c"><div class="ttname"><a href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html#a76b47510da87424e5eefdfee9d22e79c">dyno::OpticalFlowAndPoseOptimizer::Params::outlier_reject</a></div><div class="ttdeci">bool outlier_reject</div><div class="ttdef"><b>Definition:</b> <a href="MotionSolver_8hpp_source.html#l00136">MotionSolver.hpp:136</a></div></div>
<div class="ttc" id="astructdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params_html_abad2967ead84f407fe0652b9193120da"><div class="ttname"><a href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html#abad2967ead84f407fe0652b9193120da">dyno::OpticalFlowAndPoseOptimizer::Params::k_huber</a></div><div class="ttdeci">double k_huber</div><div class="ttdef"><b>Definition:</b> <a href="MotionSolver_8hpp_source.html#l00135">MotionSolver.hpp:135</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="classdyno_1_1utils_1_1StatsCollectorImpl.html#ab92087ce27dbec18730bf779e48d6aec">dyno::utils::StatsCollectorImpl::AddSample()</a>, <a class="el" href="structdyno_1_1SolverResult.html#ac780db495ed8f4f6bc1d469033e1b88f">dyno::SolverResult&lt; T &gt;::best_result</a>, <a class="el" href="namespacedyno_1_1factor__graph__tools.html#af7b6cb76226919a10ad3cdac2ba3ac6a">dyno::factor_graph_tools::determineFactorOutliers()</a>, <a class="el" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html#a679c707ed2f40d369c7292ce94537d2f">dyno::OpticalFlowAndPoseOptimizer::Params::flow_prior_sigma</a>, <a class="el" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html#a3d8f270eb76364610027ab5a466334ac">dyno::OpticalFlowAndPoseOptimizer::Params::flow_sigma</a>, <a class="el" href="structdyno_1_1SolverResult.html#a72ed8a5ed98d840f15e5e62863da2457">dyno::SolverResult&lt; T &gt;::inliers</a>, <a class="el" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html#abad2967ead84f407fe0652b9193120da">dyno::OpticalFlowAndPoseOptimizer::Params::k_huber</a>, <a class="el" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html#a76b47510da87424e5eefdfee9d22e79c">dyno::OpticalFlowAndPoseOptimizer::Params::outlier_reject</a>, <a class="el" href="structdyno_1_1SolverResult.html#ae673e2cd839da80eee3a46267cf4516b">dyno::SolverResult&lt; T &gt;::outliers</a>, and <a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#afd94858cb502bb37ae83cb4d482f7d0e">params_</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classdyno_1_1OpticalFlowAndPoseOptimizer_a4ed1443b579b5e4847a00b4a85da81d9_cgraph.png" border="0" usemap="#aclassdyno_1_1OpticalFlowAndPoseOptimizer_a4ed1443b579b5e4847a00b4a85da81d9_cgraph" alt=""/></div>
<map name="aclassdyno_1_1OpticalFlowAndPoseOptimizer_a4ed1443b579b5e4847a00b4a85da81d9_cgraph" id="aclassdyno_1_1OpticalFlowAndPoseOptimizer_a4ed1443b579b5e4847a00b4a85da81d9_cgraph">
<area shape="rect" title="Builds the factor&#45;graph problem using the set of specificed correspondences (tracklets) in frame k&#45;1 ..." alt="" coords="5,88,200,128"/>
<area shape="rect" href="classdyno_1_1utils_1_1StatsCollectorImpl.html#ab92087ce27dbec18730bf779e48d6aec" title=" " alt="" coords="267,56,456,96"/>
<area shape="rect" href="namespacedyno_1_1factor__graph__tools.html#af7b6cb76226919a10ad3cdac2ba3ac6a" title=" " alt="" coords="248,120,475,160"/>
<area shape="rect" href="classdyno_1_1utils_1_1Statistics.html#a1c18a39943c66b2bd4b6a788ed2c06be" title=" " alt="" coords="543,5,702,45"/>
<area shape="rect" href="classdyno_1_1utils_1_1Statistics.html#a755d6b65c1cbd3b81bf3b431fd6e8bfd" title=" " alt="" coords="771,35,929,75"/>
<area shape="rect" href="namespacedyno.html#a45aa2da5e284a5b1014c7d698ae91afc" title="Compute the quantile function of the Chi&#45;Squared distribution." alt="" coords="523,127,723,153"/>
</map>
</div>

</div>
</div>
<a id="ad96216e768fc5dea6e6411222bac0ddd" name="ad96216e768fc5dea6e6411222bac0ddd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad96216e768fc5dea6e6411222bac0ddd">&#9670;&#160;</a></span>optimizeAndUpdate()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename CALIBRATION &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#a09e6319df4385bc229ac07b3555d6589">OpticalFlowAndPoseOptimizer::Result</a> dyno::OpticalFlowAndPoseOptimizer::optimizeAndUpdate </td>
          <td>(</td>
          <td class="paramtype">Frame::Ptr&#160;</td>
          <td class="paramname"><em>frame_k_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Frame::Ptr&#160;</td>
          <td class="paramname"><em>frame_k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacedyno.html#a7b74611da938f0d55a3b1fdb16219037">TrackletIds</a> &amp;&#160;</td>
          <td class="paramname"><em>tracklets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gtsam::Pose3 &amp;&#160;</td>
          <td class="paramname"><em>initial_pose</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Builds the factor-graph problem using the set of specificed correspondences (tracklets) in frame k-1 and k and the initial pose. Unlike the optimize only version this also update the features within the frames as outliers after optimisation. It will also update the feature data (depth keypoint etc...) with the refined flows. </p>
<p>It will NOT update the frame with the result pose as this could be any pose.</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">CALIBRATION</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">frame_k_1</td><td></td></tr>
    <tr><td class="paramname">frame_k</td><td></td></tr>
    <tr><td class="paramname">tracklets</td><td></td></tr>
    <tr><td class="paramname">initial_pose</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Result </dd></dl>

<p class="definition">Definition at line <a class="el" href="MotionSolver-inl_8hpp_source.html#l00286">286</a> of file <a class="el" href="MotionSolver-inl_8hpp_source.html">MotionSolver-inl.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  288</span>                                          {</div>
<div class="line"><span class="lineno">  289</span>  <span class="keyword">auto</span> result =</div>
<div class="line"><span class="lineno">  290</span>      this-&gt;optimize&lt;CALIBRATION&gt;(frame_k_1, frame_k, tracklets, initial_pose);</div>
<div class="line"><span class="lineno">  291</span>  <a class="code hl_function" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#af1037c8661213cd6e602b30918b6b3ec">updateFrameOutliersWithResult</a>(result, frame_k_1, frame_k);</div>
<div class="line"><span class="lineno">  292</span>  <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  293</span>}</div>
<div class="ttc" id="aclassdyno_1_1OpticalFlowAndPoseOptimizer_html_af1037c8661213cd6e602b30918b6b3ec"><div class="ttname"><a href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#af1037c8661213cd6e602b30918b6b3ec">dyno::OpticalFlowAndPoseOptimizer::updateFrameOutliersWithResult</a></div><div class="ttdeci">void updateFrameOutliersWithResult(const Result &amp;result, Frame::Ptr frame_k_1, Frame::Ptr frame_k) const</div><div class="ttdef"><b>Definition:</b> <a href="MotionSolver_8cc_source.html#l00301">MotionSolver.cc:301</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#af1037c8661213cd6e602b30918b6b3ec">updateFrameOutliersWithResult()</a>.</p>

<p class="reference">Referenced by <a class="el" href="classdyno_1_1ObjectMotionSovlerF2F.html#a432924457f5c458282c63002648b99a9">dyno::ObjectMotionSovlerF2F::geometricOutlierRejection3d2d()</a>, and <a class="el" href="classdyno_1_1RGBDInstanceFrontendModule.html#ad89ae2ee89eaa41ef536e2e409809b69">dyno::RGBDInstanceFrontendModule::solveCameraMotion()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classdyno_1_1OpticalFlowAndPoseOptimizer_ad96216e768fc5dea6e6411222bac0ddd_cgraph.png" border="0" usemap="#aclassdyno_1_1OpticalFlowAndPoseOptimizer_ad96216e768fc5dea6e6411222bac0ddd_cgraph" alt=""/></div>
<map name="aclassdyno_1_1OpticalFlowAndPoseOptimizer_ad96216e768fc5dea6e6411222bac0ddd_cgraph" id="aclassdyno_1_1OpticalFlowAndPoseOptimizer_ad96216e768fc5dea6e6411222bac0ddd_cgraph">
<area shape="rect" title="Builds the factor&#45;graph problem using the set of specificed correspondences (tracklets) in frame k&#45;1 ..." alt="" coords="5,63,228,103"/>
<area shape="rect" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#af1037c8661213cd6e602b30918b6b3ec" title=" " alt="" coords="276,55,507,110"/>
<area shape="rect" href="classdyno_1_1Feature.html#a37dbbe8da704c2f51e237d38760534fb" title=" " alt="" coords="568,5,748,45"/>
<area shape="rect" href="structdyno_1_1functional__keypoint.html#a3896d96a6f95b5311ae768cdd0ad97e8" title=" " alt="" coords="555,70,761,95"/>
<area shape="rect" href="structdyno_1_1functional__keypoint.html#a24933450cad8bc70b7b76b339756cd94" title=" " alt="" coords="555,119,761,145"/>
<area shape="rect" href="classdyno_1_1Feature.html#ada9f9980d950874a7a157a82b9921f8a" title="Gets keypoint observation." alt="" coords="809,13,984,38"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classdyno_1_1OpticalFlowAndPoseOptimizer_ad96216e768fc5dea6e6411222bac0ddd_icgraph.png" border="0" usemap="#aclassdyno_1_1OpticalFlowAndPoseOptimizer_ad96216e768fc5dea6e6411222bac0ddd_icgraph" alt=""/></div>
<map name="aclassdyno_1_1OpticalFlowAndPoseOptimizer_ad96216e768fc5dea6e6411222bac0ddd_icgraph" id="aclassdyno_1_1OpticalFlowAndPoseOptimizer_ad96216e768fc5dea6e6411222bac0ddd_icgraph">
<area shape="rect" title="Builds the factor&#45;graph problem using the set of specificed correspondences (tracklets) in frame k&#45;1 ..." alt="" coords="569,37,792,77"/>
<area shape="rect" href="classdyno_1_1ObjectMotionSovlerF2F.html#a432924457f5c458282c63002648b99a9" title=" " alt="" coords="265,5,521,45"/>
<area shape="rect" href="classdyno_1_1RGBDInstanceFrontendModule.html#ad89ae2ee89eaa41ef536e2e409809b69" title="Solves PnP between frame_k&#45;1 and frame_k using the tracked correspondances to estimate the frame of t..." alt="" coords="287,69,499,109"/>
<area shape="rect" href="classdyno_1_1RGBDInstanceFrontendModule.html#a4528368033583ee53198dac3a803c5f2" title=" " alt="" coords="5,69,217,109"/>
</map>
</div>

</div>
</div>
<a id="af1037c8661213cd6e602b30918b6b3ec" name="af1037c8661213cd6e602b30918b6b3ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1037c8661213cd6e602b30918b6b3ec">&#9670;&#160;</a></span>updateFrameOutliersWithResult()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void dyno::OpticalFlowAndPoseOptimizer::updateFrameOutliersWithResult </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#a09e6319df4385bc229ac07b3555d6589">Result</a> &amp;&#160;</td>
          <td class="paramname"><em>result</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Frame::Ptr&#160;</td>
          <td class="paramname"><em>frame_k_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Frame::Ptr&#160;</td>
          <td class="paramname"><em>frame_k</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MotionSolver_8cc_source.html#l00301">301</a> of file <a class="el" href="MotionSolver_8cc_source.html">MotionSolver.cc</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  302</span>                                                                      {</div>
<div class="line"><span class="lineno">  303</span>  utils::TimingStatsCollector timer(<span class="stringliteral">&quot;of_motion_solver.update_frame&quot;</span>);</div>
<div class="line"><span class="lineno">  304</span>  <span class="comment">// //original flow image that goes from k to k+1 (gross, im sorry!)</span></div>
<div class="line"><span class="lineno">  305</span>  <span class="comment">// TODO: use flow_is_future param</span></div>
<div class="line"><span class="lineno">  306</span>  <span class="keyword">const</span> cv::Mat&amp; flow_image = frame_k-&gt;image_container_.opticalFlow();</div>
<div class="line"><span class="lineno">  307</span>  <span class="keyword">const</span> cv::Mat&amp; motion_mask = frame_k-&gt;image_container_.objectMotionMask();</div>
<div class="line"><span class="lineno">  308</span> </div>
<div class="line"><span class="lineno">  309</span>  <span class="keyword">auto</span> camera = frame_k-&gt;camera_;</div>
<div class="line"><span class="lineno">  310</span>  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; refined_inliers = result.inliers;</div>
<div class="line"><span class="lineno">  311</span>  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; refined_flows = result.best_result.refined_flows;</div>
<div class="line"><span class="lineno">  312</span> </div>
<div class="line"><span class="lineno">  313</span>  <span class="comment">// outliers from the result. We will update this vector with new outliers</span></div>
<div class="line"><span class="lineno">  314</span>  <span class="keyword">auto</span> refined_outliers = result.outliers;</div>
<div class="line"><span class="lineno">  315</span> </div>
<div class="line"><span class="lineno">  316</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; refined_inliers.size(); i++) {</div>
<div class="line"><span class="lineno">  317</span>    <a class="code hl_typedef" href="namespacedyno.html#afdd174eb44901fb205371d796287378c">TrackletId</a> tracklet_id = refined_inliers.at(i);</div>
<div class="line"><span class="lineno">  318</span>    gtsam::Point2 refined_flow = refined_flows.at(i);</div>
<div class="line"><span class="lineno">  319</span> </div>
<div class="line"><span class="lineno">  320</span>    <span class="keyword">const</span> Feature::Ptr feature_k_1 = frame_k_1-&gt;at(tracklet_id);</div>
<div class="line"><span class="lineno">  321</span>    Feature::Ptr feature_k = frame_k-&gt;at(tracklet_id);</div>
<div class="line"><span class="lineno">  322</span> </div>
<div class="line"><span class="lineno">  323</span>    CHECK_EQ(feature_k-&gt;objectId(), result.best_result.object_id);</div>
<div class="line"><span class="lineno">  324</span> </div>
<div class="line"><span class="lineno">  325</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="namespacedyno.html#aaa260a8022691078c59e1ac6a4fa05b5">Keypoint</a> kp_k_1 = feature_k_1-&gt;keypoint();</div>
<div class="line"><span class="lineno">  326</span>    <a class="code hl_typedef" href="namespacedyno.html#aaa260a8022691078c59e1ac6a4fa05b5">Keypoint</a> refined_keypoint = kp_k_1 + refined_flow;</div>
<div class="line"><span class="lineno">  327</span> </div>
<div class="line"><span class="lineno">  328</span>    <span class="comment">// check boundaries?</span></div>
<div class="line"><span class="lineno">  329</span>    <span class="keywordflow">if</span> (!camera-&gt;isKeypointContained(refined_keypoint)) {</div>
<div class="line"><span class="lineno">  330</span>      refined_outliers.push_back(tracklet_id);</div>
<div class="line"><span class="lineno">  331</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  332</span>    }</div>
<div class="line"><span class="lineno">  333</span> </div>
<div class="line"><span class="lineno">  334</span>    <a class="code hl_typedef" href="namespacedyno.html#a38bb86e4154b86428b8d133be03fb2b5">ObjectId</a> predicted_label =</div>
<div class="line"><span class="lineno">  335</span>        functional_keypoint::at&lt;ObjectId&gt;(refined_keypoint, motion_mask);</div>
<div class="line"><span class="lineno">  336</span>    <span class="keywordflow">if</span> (predicted_label != result.best_result.object_id) {</div>
<div class="line"><span class="lineno">  337</span>      refined_outliers.push_back(tracklet_id);</div>
<div class="line"><span class="lineno">  338</span>      <span class="comment">// TODO: other fields of the feature does not get updated? Inconsistencies</span></div>
<div class="line"><span class="lineno">  339</span>      <span class="comment">// as measured flow, predicted kp etc are no longer correct!!?</span></div>
<div class="line"><span class="lineno">  340</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  341</span>    }</div>
<div class="line"><span class="lineno">  342</span> </div>
<div class="line"><span class="lineno">  343</span>    <span class="comment">// we now have to update the prediced keypoint using the original flow!!</span></div>
<div class="line"><span class="lineno">  344</span>    <span class="comment">// TODO: code copied from feature tracker</span></div>
<div class="line"><span class="lineno">  345</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> x = <a class="code hl_function" href="structdyno_1_1functional__keypoint.html#a3896d96a6f95b5311ae768cdd0ad97e8">functional_keypoint::u</a>(refined_keypoint);</div>
<div class="line"><span class="lineno">  346</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> y = <a class="code hl_function" href="structdyno_1_1functional__keypoint.html#a24933450cad8bc70b7b76b339756cd94">functional_keypoint::v</a>(refined_keypoint);</div>
<div class="line"><span class="lineno">  347</span>    <span class="keywordtype">double</span> flow_xe = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(flow_image.at&lt;cv::Vec2f&gt;(y, x)[0]);</div>
<div class="line"><span class="lineno">  348</span>    <span class="keywordtype">double</span> flow_ye = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(flow_image.at&lt;cv::Vec2f&gt;(y, x)[1]);</div>
<div class="line"><span class="lineno">  349</span>    <span class="comment">// the measured flow after the origin has been updated</span></div>
<div class="line"><span class="lineno">  350</span>    <a class="code hl_typedef" href="namespacedyno.html#aba8bf92162160923c6e5c7249892d5f8">OpticalFlow</a> new_measured_flow(flow_xe, flow_ye);</div>
<div class="line"><span class="lineno">  351</span>    feature_k-&gt;measuredFlow(new_measured_flow);</div>
<div class="line"><span class="lineno">  352</span>    <span class="comment">// TODO: check predicted flow is within image</span></div>
<div class="line"><span class="lineno">  353</span>    <a class="code hl_typedef" href="namespacedyno.html#aaa260a8022691078c59e1ac6a4fa05b5">Keypoint</a> predicted_kp = <a class="code hl_function" href="classdyno_1_1Feature.html#a37dbbe8da704c2f51e237d38760534fb">Feature::CalculatePredictedKeypoint</a>(</div>
<div class="line"><span class="lineno">  354</span>        refined_keypoint, new_measured_flow);</div>
<div class="line"><span class="lineno">  355</span>    feature_k-&gt;predictedKeypoint(predicted_kp);</div>
<div class="line"><span class="lineno">  356</span>    feature_k-&gt;keypoint(refined_keypoint);</div>
<div class="line"><span class="lineno">  357</span>  }</div>
<div class="line"><span class="lineno">  358</span> </div>
<div class="line"><span class="lineno">  359</span>  <span class="comment">// update tracks</span></div>
<div class="line"><span class="lineno">  360</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; outlier_tracklet : refined_outliers) {</div>
<div class="line"><span class="lineno">  361</span>    Feature::Ptr feature_k_1 = frame_k_1-&gt;at(outlier_tracklet);</div>
<div class="line"><span class="lineno">  362</span>    Feature::Ptr feature_k = frame_k-&gt;at(outlier_tracklet);</div>
<div class="line"><span class="lineno">  363</span> </div>
<div class="line"><span class="lineno">  364</span>    CHECK(feature_k_1-&gt;usable());</div>
<div class="line"><span class="lineno">  365</span>    CHECK(feature_k-&gt;usable());</div>
<div class="line"><span class="lineno">  366</span> </div>
<div class="line"><span class="lineno">  367</span>    feature_k-&gt;markOutlier();</div>
<div class="line"><span class="lineno">  368</span>    feature_k_1-&gt;markOutlier();</div>
<div class="line"><span class="lineno">  369</span>  }</div>
<div class="line"><span class="lineno">  370</span> </div>
<div class="line"><span class="lineno">  371</span>  <span class="comment">// refresh depth information for each frame</span></div>
<div class="line"><span class="lineno">  372</span>  CHECK(frame_k-&gt;updateDepths());</div>
<div class="line"><span class="lineno">  373</span>}</div>
<div class="ttc" id="aclassdyno_1_1Feature_html_a37dbbe8da704c2f51e237d38760534fb"><div class="ttname"><a href="classdyno_1_1Feature.html#a37dbbe8da704c2f51e237d38760534fb">dyno::Feature::CalculatePredictedKeypoint</a></div><div class="ttdeci">static Keypoint CalculatePredictedKeypoint(const Keypoint &amp;keypoint, const OpticalFlow &amp;measured_flow)</div><div class="ttdef"><b>Definition:</b> <a href="Feature_8hpp_source.html#l00229">Feature.hpp:229</a></div></div>
<div class="ttc" id="anamespacedyno_html_a38bb86e4154b86428b8d133be03fb2b5"><div class="ttname"><a href="namespacedyno.html#a38bb86e4154b86428b8d133be03fb2b5">dyno::ObjectId</a></div><div class="ttdeci">int ObjectId</div><div class="ttdoc">Discrete object id, j.</div><div class="ttdef"><b>Definition:</b> <a href="Types_8hpp_source.html#l00070">Types.hpp:70</a></div></div>
<div class="ttc" id="anamespacedyno_html_aba8bf92162160923c6e5c7249892d5f8"><div class="ttname"><a href="namespacedyno.html#aba8bf92162160923c6e5c7249892d5f8">dyno::OpticalFlow</a></div><div class="ttdeci">gtsam::Point2 OpticalFlow</div><div class="ttdef"><b>Definition:</b> <a href="Types_8hpp_source.html#l00093">Types.hpp:94</a></div></div>
<div class="ttc" id="astructdyno_1_1functional__keypoint_html_a24933450cad8bc70b7b76b339756cd94"><div class="ttname"><a href="structdyno_1_1functional__keypoint.html#a24933450cad8bc70b7b76b339756cd94">dyno::functional_keypoint::v</a></div><div class="ttdeci">static int v(const Keypoint &amp;kp)</div><div class="ttdef"><b>Definition:</b> <a href="Feature_8hpp_source.html#l00053">Feature.hpp:53</a></div></div>
<div class="ttc" id="astructdyno_1_1functional__keypoint_html_a3896d96a6f95b5311ae768cdd0ad97e8"><div class="ttname"><a href="structdyno_1_1functional__keypoint.html#a3896d96a6f95b5311ae768cdd0ad97e8">dyno::functional_keypoint::u</a></div><div class="ttdeci">static T u(const Keypoint &amp;kp)</div><div class="ttdef"><b>Definition:</b> <a href="Feature_8hpp_source.html#l00048">Feature.hpp:48</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structdyno_1_1SolverResult.html#ac780db495ed8f4f6bc1d469033e1b88f">dyno::SolverResult&lt; T &gt;::best_result</a>, <a class="el" href="classdyno_1_1Feature.html#a37dbbe8da704c2f51e237d38760534fb">dyno::Feature::CalculatePredictedKeypoint()</a>, <a class="el" href="structdyno_1_1SolverResult.html#a72ed8a5ed98d840f15e5e62863da2457">dyno::SolverResult&lt; T &gt;::inliers</a>, <a class="el" href="structdyno_1_1SolverResult.html#ae673e2cd839da80eee3a46267cf4516b">dyno::SolverResult&lt; T &gt;::outliers</a>, <a class="el" href="structdyno_1_1functional__keypoint.html#a3896d96a6f95b5311ae768cdd0ad97e8">dyno::functional_keypoint::u()</a>, and <a class="el" href="structdyno_1_1functional__keypoint.html#a24933450cad8bc70b7b76b339756cd94">dyno::functional_keypoint::v()</a>.</p>

<p class="reference">Referenced by <a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#ad96216e768fc5dea6e6411222bac0ddd">optimizeAndUpdate()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classdyno_1_1OpticalFlowAndPoseOptimizer_af1037c8661213cd6e602b30918b6b3ec_cgraph.png" border="0" usemap="#aclassdyno_1_1OpticalFlowAndPoseOptimizer_af1037c8661213cd6e602b30918b6b3ec_cgraph" alt=""/></div>
<map name="aclassdyno_1_1OpticalFlowAndPoseOptimizer_af1037c8661213cd6e602b30918b6b3ec_cgraph" id="aclassdyno_1_1OpticalFlowAndPoseOptimizer_af1037c8661213cd6e602b30918b6b3ec_cgraph">
<area shape="rect" title=" " alt="" coords="5,55,236,110"/>
<area shape="rect" href="classdyno_1_1Feature.html#a37dbbe8da704c2f51e237d38760534fb" title=" " alt="" coords="297,5,477,45"/>
<area shape="rect" href="structdyno_1_1functional__keypoint.html#a3896d96a6f95b5311ae768cdd0ad97e8" title=" " alt="" coords="284,70,491,95"/>
<area shape="rect" href="structdyno_1_1functional__keypoint.html#a24933450cad8bc70b7b76b339756cd94" title=" " alt="" coords="284,119,491,145"/>
<area shape="rect" href="classdyno_1_1Feature.html#ada9f9980d950874a7a157a82b9921f8a" title="Gets keypoint observation." alt="" coords="539,13,713,38"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classdyno_1_1OpticalFlowAndPoseOptimizer_af1037c8661213cd6e602b30918b6b3ec_icgraph.png" border="0" usemap="#aclassdyno_1_1OpticalFlowAndPoseOptimizer_af1037c8661213cd6e602b30918b6b3ec_icgraph" alt=""/></div>
<map name="aclassdyno_1_1OpticalFlowAndPoseOptimizer_af1037c8661213cd6e602b30918b6b3ec_icgraph" id="aclassdyno_1_1OpticalFlowAndPoseOptimizer_af1037c8661213cd6e602b30918b6b3ec_icgraph">
<area shape="rect" title=" " alt="" coords="840,30,1071,85"/>
<area shape="rect" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#ad96216e768fc5dea6e6411222bac0ddd" title="Builds the factor&#45;graph problem using the set of specificed correspondences (tracklets) in frame k&#45;1 ..." alt="" coords="569,37,792,77"/>
<area shape="rect" href="classdyno_1_1ObjectMotionSovlerF2F.html#a432924457f5c458282c63002648b99a9" title=" " alt="" coords="265,5,521,45"/>
<area shape="rect" href="classdyno_1_1RGBDInstanceFrontendModule.html#ad89ae2ee89eaa41ef536e2e409809b69" title="Solves PnP between frame_k&#45;1 and frame_k using the tracked correspondances to estimate the frame of t..." alt="" coords="287,69,499,109"/>
<area shape="rect" href="classdyno_1_1RGBDInstanceFrontendModule.html#a4528368033583ee53198dac3a803c5f2" title=" " alt="" coords="5,69,217,109"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="afd94858cb502bb37ae83cb4d482f7d0e" name="afd94858cb502bb37ae83cb4d482f7d0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd94858cb502bb37ae83cb4d482f7d0e">&#9670;&#160;</a></span>params_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdyno_1_1OpticalFlowAndPoseOptimizer_1_1Params.html">Params</a> dyno::OpticalFlowAndPoseOptimizer::params_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MotionSolver_8hpp_source.html#l00210">210</a> of file <a class="el" href="MotionSolver_8hpp_source.html">MotionSolver.hpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="classdyno_1_1OpticalFlowAndPoseOptimizer.html#a4ed1443b579b5e4847a00b4a85da81d9">optimize()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>dynosam/include/dynosam/frontend/vision/<a class="el" href="MotionSolver_8hpp_source.html">MotionSolver.hpp</a></li>
<li>dynosam/include/dynosam/frontend/vision/<a class="el" href="MotionSolver-inl_8hpp_source.html">MotionSolver-inl.hpp</a></li>
<li>dynosam/src/frontend/vision/<a class="el" href="MotionSolver_8cc_source.html">MotionSolver.cc</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
