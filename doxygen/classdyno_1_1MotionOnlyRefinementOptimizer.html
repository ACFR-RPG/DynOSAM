<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DynoSAM: dyno::MotionOnlyRefinementOptimizer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DynoSAM
   </div>
   <div id="projectbrief">Dynamic Object Smoothing and Mapping for Dynamic SLAM</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacedyno.html">dyno</a></li><li class="navelem"><a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html">MotionOnlyRefinementOptimizer</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classdyno_1_1MotionOnlyRefinementOptimizer-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">dyno::MotionOnlyRefinementOptimizer Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Jointly refined the motion of an object using the 3D-motion-residual.  
 <a href="classdyno_1_1MotionOnlyRefinementOptimizer.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="MotionSolver_8hpp_source.html">MotionSolver.hpp</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for dyno::MotionOnlyRefinementOptimizer:</div>
<div class="dyncontent">
<div class="center"><img src="classdyno_1_1MotionOnlyRefinementOptimizer__coll__graph.png" border="0" usemap="#adyno_1_1MotionOnlyRefinementOptimizer_coll__map" alt="Collaboration graph"/></div>
<map name="adyno_1_1MotionOnlyRefinementOptimizer_coll__map" id="adyno_1_1MotionOnlyRefinementOptimizer_coll__map">
<area shape="rect" title="Jointly refined the motion of an object using the 3D&#45;motion&#45;residual." alt="" coords="5,108,217,148"/>
<area shape="rect" href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html" title=" " alt="" coords="5,5,217,45"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html">Params</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a62fb52bd592e738694e8851bf8e0fd99"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99">RefinementSolver</a> { <a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99a83dddddaeb67cbe0d684911c66dc4b14">ProjectionError</a>
, <a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99aed53fa669f1a05cfee80463c8c94f122">PointError</a>
 }</td></tr>
<tr class="separator:a62fb52bd592e738694e8851bf8e0fd99"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a71890be7af35f06ca06d04763f113b40"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a71890be7af35f06ca06d04763f113b40">MotionOnlyRefinementOptimizer</a> (const <a class="el" href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html">Params</a> &amp;params)</td></tr>
<tr class="separator:a71890be7af35f06ca06d04763f113b40"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab9ea6586ab1c0a64f008a05a38350aae"><td class="memTemplParams" colspan="2">template&lt;typename CALIBRATION &gt; </td></tr>
<tr class="memitem:ab9ea6586ab1c0a64f008a05a38350aae"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="namespacedyno.html#a80a44a3e6e4745a2514ffdc58dbcfaac">Pose3SolverResult</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#ab9ea6586ab1c0a64f008a05a38350aae">optimize</a> (const Frame::Ptr frame_k_1, const Frame::Ptr frame_k, const <a class="el" href="namespacedyno.html#a7b74611da938f0d55a3b1fdb16219037">TrackletIds</a> &amp;tracklets, const <a class="el" href="namespacedyno.html#a38bb86e4154b86428b8d133be03fb2b5">ObjectId</a> object_id, const gtsam::Pose3 &amp;initial_motion, const <a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99">RefinementSolver</a> &amp;solver=<a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99a83dddddaeb67cbe0d684911c66dc4b14">RefinementSolver::ProjectionError</a>) const</td></tr>
<tr class="separator:ab9ea6586ab1c0a64f008a05a38350aae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a892ae86966052c856c312099c68462"><td class="memTemplParams" colspan="2">template&lt;typename CALIBRATION &gt; </td></tr>
<tr class="memitem:a6a892ae86966052c856c312099c68462"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="namespacedyno.html#a80a44a3e6e4745a2514ffdc58dbcfaac">Pose3SolverResult</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a6a892ae86966052c856c312099c68462">optimizeAndUpdate</a> (Frame::Ptr frame_k_1, Frame::Ptr frame_k, const <a class="el" href="namespacedyno.html#a7b74611da938f0d55a3b1fdb16219037">TrackletIds</a> &amp;tracklets, const <a class="el" href="namespacedyno.html#a38bb86e4154b86428b8d133be03fb2b5">ObjectId</a> object_id, const gtsam::Pose3 &amp;initial_motion, const <a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99">RefinementSolver</a> &amp;solver=<a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99a83dddddaeb67cbe0d684911c66dc4b14">RefinementSolver::ProjectionError</a>) const</td></tr>
<tr class="separator:a6a892ae86966052c856c312099c68462"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a340d76ff81e95c55de4c84b6f4f20970"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html">Params</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a340d76ff81e95c55de4c84b6f4f20970">params_</a></td></tr>
<tr class="separator:a340d76ff81e95c55de4c84b6f4f20970"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Jointly refined the motion of an object using the 3D-motion-residual. </p>

<p class="definition">Definition at line <a class="el" href="MotionSolver_8hpp_source.html#l00219">219</a> of file <a class="el" href="MotionSolver_8hpp_source.html">MotionSolver.hpp</a>.</p>
</div><h2 class="groupheader">Member Enumeration Documentation</h2>
<a id="a62fb52bd592e738694e8851bf8e0fd99" name="a62fb52bd592e738694e8851bf8e0fd99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62fb52bd592e738694e8851bf8e0fd99">&#9670;&#160;</a></span>RefinementSolver</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99">dyno::MotionOnlyRefinementOptimizer::RefinementSolver</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a62fb52bd592e738694e8851bf8e0fd99a83dddddaeb67cbe0d684911c66dc4b14" name="a62fb52bd592e738694e8851bf8e0fd99a83dddddaeb67cbe0d684911c66dc4b14"></a>ProjectionError&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a62fb52bd592e738694e8851bf8e0fd99aed53fa669f1a05cfee80463c8c94f122" name="a62fb52bd592e738694e8851bf8e0fd99aed53fa669f1a05cfee80463c8c94f122"></a>PointError&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="MotionSolver_8hpp_source.html#l00229">229</a> of file <a class="el" href="MotionSolver_8hpp_source.html">MotionSolver.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  229</span>{ <a class="code hl_enumvalue" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99a83dddddaeb67cbe0d684911c66dc4b14">ProjectionError</a>, <a class="code hl_enumvalue" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99aed53fa669f1a05cfee80463c8c94f122">PointError</a> };</div>
<div class="ttc" id="aclassdyno_1_1MotionOnlyRefinementOptimizer_html_a62fb52bd592e738694e8851bf8e0fd99a83dddddaeb67cbe0d684911c66dc4b14"><div class="ttname"><a href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99a83dddddaeb67cbe0d684911c66dc4b14">dyno::MotionOnlyRefinementOptimizer::ProjectionError</a></div><div class="ttdeci">@ ProjectionError</div><div class="ttdef"><b>Definition:</b> <a href="MotionSolver_8hpp_source.html#l00229">MotionSolver.hpp:229</a></div></div>
<div class="ttc" id="aclassdyno_1_1MotionOnlyRefinementOptimizer_html_a62fb52bd592e738694e8851bf8e0fd99aed53fa669f1a05cfee80463c8c94f122"><div class="ttname"><a href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99aed53fa669f1a05cfee80463c8c94f122">dyno::MotionOnlyRefinementOptimizer::PointError</a></div><div class="ttdeci">@ PointError</div><div class="ttdef"><b>Definition:</b> <a href="MotionSolver_8hpp_source.html#l00229">MotionSolver.hpp:229</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a71890be7af35f06ca06d04763f113b40" name="a71890be7af35f06ca06d04763f113b40"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71890be7af35f06ca06d04763f113b40">&#9670;&#160;</a></span>MotionOnlyRefinementOptimizer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">dyno::MotionOnlyRefinementOptimizer::MotionOnlyRefinementOptimizer </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html">Params</a> &amp;&#160;</td>
          <td class="paramname"><em>params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MotionSolver_8hpp_source.html#l00228">228</a> of file <a class="el" href="MotionSolver_8hpp_source.html">MotionSolver.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  228</span>: <a class="code hl_variable" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a340d76ff81e95c55de4c84b6f4f20970">params_</a>(params) {}</div>
<div class="ttc" id="aclassdyno_1_1MotionOnlyRefinementOptimizer_html_a340d76ff81e95c55de4c84b6f4f20970"><div class="ttname"><a href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a340d76ff81e95c55de4c84b6f4f20970">dyno::MotionOnlyRefinementOptimizer::params_</a></div><div class="ttdeci">Params params_</div><div class="ttdef"><b>Definition:</b> <a href="MotionSolver_8hpp_source.html#l00245">MotionSolver.hpp:245</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ab9ea6586ab1c0a64f008a05a38350aae" name="ab9ea6586ab1c0a64f008a05a38350aae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab9ea6586ab1c0a64f008a05a38350aae">&#9670;&#160;</a></span>optimize()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename CALIBRATION &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacedyno.html#a80a44a3e6e4745a2514ffdc58dbcfaac">Pose3SolverResult</a> dyno::MotionOnlyRefinementOptimizer::optimize </td>
          <td>(</td>
          <td class="paramtype">const Frame::Ptr&#160;</td>
          <td class="paramname"><em>frame_k_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Frame::Ptr&#160;</td>
          <td class="paramname"><em>frame_k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacedyno.html#a7b74611da938f0d55a3b1fdb16219037">TrackletIds</a> &amp;&#160;</td>
          <td class="paramname"><em>tracklets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacedyno.html#a38bb86e4154b86428b8d133be03fb2b5">ObjectId</a>&#160;</td>
          <td class="paramname"><em>object_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gtsam::Pose3 &amp;&#160;</td>
          <td class="paramname"><em>initial_motion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99">RefinementSolver</a> &amp;&#160;</td>
          <td class="paramname"><em>solver</em> = <code><a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99a83dddddaeb67cbe0d684911c66dc4b14">RefinementSolver::ProjectionError</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MotionSolver-inl_8hpp_source.html#l00293">293</a> of file <a class="el" href="MotionSolver-inl_8hpp_source.html">MotionSolver-inl.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  296</span>                                                                            {</div>
<div class="line"><span class="lineno">  297</span>  gtsam::NonlinearFactorGraph graph;</div>
<div class="line"><span class="lineno">  298</span>  gtsam::Values values;</div>
<div class="line"><span class="lineno">  299</span> </div>
<div class="line"><span class="lineno">  300</span>  <span class="comment">// noise models are chosen arbitrarily :)</span></div>
<div class="line"><span class="lineno">  301</span>  gtsam::SharedNoiseModel landmark_motion_noise =</div>
<div class="line"><span class="lineno">  302</span>      gtsam::noiseModel::Isotropic::Sigma(3u, <a class="code hl_variable" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a340d76ff81e95c55de4c84b6f4f20970">params_</a>.<a class="code hl_variable" href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html#a46c4fd02a6e847138138df41578e43a4">landmark_motion_sigma</a>);</div>
<div class="line"><span class="lineno">  303</span> </div>
<div class="line"><span class="lineno">  304</span>  <span class="comment">// TODO: this will break if we use 3d point error</span></div>
<div class="line"><span class="lineno">  305</span>  gtsam::SharedNoiseModel projection_noise =</div>
<div class="line"><span class="lineno">  306</span>      gtsam::noiseModel::Isotropic::Sigma(2u, <a class="code hl_variable" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a340d76ff81e95c55de4c84b6f4f20970">params_</a>.<a class="code hl_variable" href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html#a484de3246636c520e3a865641291cc94">projection_sigma</a>);</div>
<div class="line"><span class="lineno">  307</span> </div>
<div class="line"><span class="lineno">  308</span>  <span class="comment">// make robust (I mean, why not?)</span></div>
<div class="line"><span class="lineno">  309</span>  landmark_motion_noise = gtsam::noiseModel::Robust::Create(</div>
<div class="line"><span class="lineno">  310</span>      gtsam::noiseModel::mEstimator::Huber::Create(<a class="code hl_variable" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a340d76ff81e95c55de4c84b6f4f20970">params_</a>.<a class="code hl_variable" href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html#a1d7dea3a8cf4c377bd9b9e6414579601">k_huber</a>),</div>
<div class="line"><span class="lineno">  311</span>      landmark_motion_noise);</div>
<div class="line"><span class="lineno">  312</span>  projection_noise = gtsam::noiseModel::Robust::Create(</div>
<div class="line"><span class="lineno">  313</span>      gtsam::noiseModel::mEstimator::Huber::Create(<a class="code hl_variable" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a340d76ff81e95c55de4c84b6f4f20970">params_</a>.<a class="code hl_variable" href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html#a1d7dea3a8cf4c377bd9b9e6414579601">k_huber</a>),</div>
<div class="line"><span class="lineno">  314</span>      projection_noise);</div>
<div class="line"><span class="lineno">  315</span> </div>
<div class="line"><span class="lineno">  316</span>  <span class="keyword">const</span> gtsam::Key pose_k_1_key = <a class="code hl_function" href="namespacedyno.html#a314d7f58c130d0aa28270309ff7500c5">CameraPoseSymbol</a>(frame_k_1-&gt;getFrameId());</div>
<div class="line"><span class="lineno">  317</span>  <span class="keyword">const</span> gtsam::Key pose_k_key = <a class="code hl_function" href="namespacedyno.html#a314d7f58c130d0aa28270309ff7500c5">CameraPoseSymbol</a>(frame_k-&gt;getFrameId());</div>
<div class="line"><span class="lineno">  318</span>  <span class="keyword">const</span> gtsam::Key object_motion_key =</div>
<div class="line"><span class="lineno">  319</span>      <a class="code hl_function" href="namespacedyno.html#a23977a9581e8b4d2b684f749ec21cba2">ObjectMotionSymbol</a>(object_id, frame_k-&gt;getFrameId());</div>
<div class="line"><span class="lineno">  320</span> </div>
<div class="line"><span class="lineno">  321</span>  values.insert(pose_k_1_key, frame_k_1-&gt;getPose());</div>
<div class="line"><span class="lineno">  322</span>  values.insert(pose_k_key, frame_k-&gt;getPose());</div>
<div class="line"><span class="lineno">  323</span>  values.insert(object_motion_key, initial_motion);</div>
<div class="line"><span class="lineno">  324</span> </div>
<div class="line"><span class="lineno">  325</span>  <span class="keyword">auto</span> gtsam_calibration = boost::make_shared&lt;CALIBRATION&gt;(</div>
<div class="line"><span class="lineno">  326</span>      frame_k_1-&gt;getFrameCamera().calibration());</div>
<div class="line"><span class="lineno">  327</span> </div>
<div class="line"><span class="lineno">  328</span>  <span class="keyword">auto</span> pose_prior = gtsam::noiseModel::Isotropic::Sigma(6u, 0.00001);</div>
<div class="line"><span class="lineno">  329</span>  graph.addPrior(pose_k_1_key, frame_k_1-&gt;getPose(), pose_prior);</div>
<div class="line"><span class="lineno">  330</span>  graph.addPrior(pose_k_key, frame_k-&gt;getPose(), pose_prior);</div>
<div class="line"><span class="lineno">  331</span> </div>
<div class="line"><span class="lineno">  332</span>  utils::ChronoTimingStats timer(<span class="stringliteral">&quot;motion_solver.object_nlo_refinement&quot;</span>);</div>
<div class="line"><span class="lineno">  333</span> </div>
<div class="line"><span class="lineno">  334</span>  <span class="keywordflow">for</span> (<a class="code hl_typedef" href="namespacedyno.html#afdd174eb44901fb205371d796287378c">TrackletId</a> tracklet_id : tracklets) {</div>
<div class="line"><span class="lineno">  335</span>    Feature::Ptr feature_k_1 = frame_k_1-&gt;at(tracklet_id);</div>
<div class="line"><span class="lineno">  336</span>    Feature::Ptr feature_k = frame_k-&gt;at(tracklet_id);</div>
<div class="line"><span class="lineno">  337</span> </div>
<div class="line"><span class="lineno">  338</span>    CHECK_NOTNULL(feature_k_1);</div>
<div class="line"><span class="lineno">  339</span>    CHECK_NOTNULL(feature_k);</div>
<div class="line"><span class="lineno">  340</span> </div>
<div class="line"><span class="lineno">  341</span>    <span class="keywordflow">if</span> (!feature_k_1-&gt;usable() || !feature_k-&gt;usable()) {</div>
<div class="line"><span class="lineno">  342</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  343</span>    }</div>
<div class="line"><span class="lineno">  344</span> </div>
<div class="line"><span class="lineno">  345</span>    CHECK(feature_k_1-&gt;hasDepth());</div>
<div class="line"><span class="lineno">  346</span>    CHECK(feature_k-&gt;hasDepth());</div>
<div class="line"><span class="lineno">  347</span> </div>
<div class="line"><span class="lineno">  348</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="namespacedyno.html#aaa260a8022691078c59e1ac6a4fa05b5">Keypoint</a> kp_k_1 = feature_k_1-&gt;keypoint();</div>
<div class="line"><span class="lineno">  349</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="namespacedyno.html#aaa260a8022691078c59e1ac6a4fa05b5">Keypoint</a> kp_k = feature_k-&gt;keypoint();</div>
<div class="line"><span class="lineno">  350</span> </div>
<div class="line"><span class="lineno">  351</span>    <span class="keyword">const</span> gtsam::Point3 lmk_k_1_world =</div>
<div class="line"><span class="lineno">  352</span>        frame_k_1-&gt;backProjectToWorld(tracklet_id);</div>
<div class="line"><span class="lineno">  353</span>    <span class="keyword">const</span> gtsam::Point3 lmk_k_world = frame_k-&gt;backProjectToWorld(tracklet_id);</div>
<div class="line"><span class="lineno">  354</span> </div>
<div class="line"><span class="lineno">  355</span>    <span class="keyword">const</span> gtsam::Point3 lmk_k_1_local =</div>
<div class="line"><span class="lineno">  356</span>        frame_k_1-&gt;backProjectToCamera(tracklet_id);</div>
<div class="line"><span class="lineno">  357</span>    <span class="keyword">const</span> gtsam::Point3 lmk_k_local = frame_k-&gt;backProjectToCamera(tracklet_id);</div>
<div class="line"><span class="lineno">  358</span> </div>
<div class="line"><span class="lineno">  359</span>    <span class="keyword">const</span> gtsam::Key lmk_k_1_key =</div>
<div class="line"><span class="lineno">  360</span>        <a class="code hl_function" href="namespacedyno.html#abd0ce4d0c7ed8fc398cc515654019802">DynamicLandmarkSymbol</a>(frame_k_1-&gt;getFrameId(), tracklet_id);</div>
<div class="line"><span class="lineno">  361</span>    <span class="keyword">const</span> gtsam::Key lmk_k_key =</div>
<div class="line"><span class="lineno">  362</span>        <a class="code hl_function" href="namespacedyno.html#abd0ce4d0c7ed8fc398cc515654019802">DynamicLandmarkSymbol</a>(frame_k-&gt;getFrameId(), tracklet_id);</div>
<div class="line"><span class="lineno">  363</span> </div>
<div class="line"><span class="lineno">  364</span>    <span class="comment">// add initial for points</span></div>
<div class="line"><span class="lineno">  365</span>    values.insert(lmk_k_1_key, lmk_k_1_world);</div>
<div class="line"><span class="lineno">  366</span>    values.insert(lmk_k_key, lmk_k_world);</div>
<div class="line"><span class="lineno">  367</span> </div>
<div class="line"><span class="lineno">  368</span>    <span class="keywordflow">if</span> (solver == <a class="code hl_enumvalue" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99aed53fa669f1a05cfee80463c8c94f122">RefinementSolver::PointError</a>) {</div>
<div class="line"><span class="lineno">  369</span>      LOG(FATAL) &lt;&lt; <span class="stringliteral">&quot;RefinementSolver::PointError not implemented&quot;</span>;</div>
<div class="line"><span class="lineno">  370</span>      <span class="comment">// graph.emplace_shared&lt;PoseToPointFactor&gt;(</span></div>
<div class="line"><span class="lineno">  371</span>      <span class="comment">//     pose_k_1_key, //pose key at previous frames</span></div>
<div class="line"><span class="lineno">  372</span>      <span class="comment">//     lmk_k_1_key,</span></div>
<div class="line"><span class="lineno">  373</span>      <span class="comment">//     lmk_k_1_local,</span></div>
<div class="line"><span class="lineno">  374</span>      <span class="comment">//     projection_noise</span></div>
<div class="line"><span class="lineno">  375</span>      <span class="comment">// );</span></div>
<div class="line"><span class="lineno">  376</span> </div>
<div class="line"><span class="lineno">  377</span>      <span class="comment">// graph.emplace_shared&lt;PoseToPointFactor&gt;(</span></div>
<div class="line"><span class="lineno">  378</span>      <span class="comment">//         pose_k_key, //pose key at current frames</span></div>
<div class="line"><span class="lineno">  379</span>      <span class="comment">//         lmk_k_key,</span></div>
<div class="line"><span class="lineno">  380</span>      <span class="comment">//         lmk_k_local,</span></div>
<div class="line"><span class="lineno">  381</span>      <span class="comment">//         projection_noise</span></div>
<div class="line"><span class="lineno">  382</span>      <span class="comment">// );</span></div>
<div class="line"><span class="lineno">  383</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (solver == <a class="code hl_enumvalue" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99a83dddddaeb67cbe0d684911c66dc4b14">RefinementSolver::ProjectionError</a>) {</div>
<div class="line"><span class="lineno">  384</span>      graph.emplace_shared&lt;<a class="code hl_typedef" href="namespacedyno.html#a0b2080ebc6273ea80d2716e39ead6525">GenericProjectionFactor</a>&gt;(</div>
<div class="line"><span class="lineno">  385</span>          kp_k_1, projection_noise, pose_k_1_key, lmk_k_1_key,</div>
<div class="line"><span class="lineno">  386</span>          gtsam_calibration, <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  387</span> </div>
<div class="line"><span class="lineno">  388</span>      graph.emplace_shared&lt;<a class="code hl_typedef" href="namespacedyno.html#a0b2080ebc6273ea80d2716e39ead6525">GenericProjectionFactor</a>&gt;(</div>
<div class="line"><span class="lineno">  389</span>          kp_k, projection_noise, pose_k_key, lmk_k_key, gtsam_calibration,</div>
<div class="line"><span class="lineno">  390</span>          <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  391</span>    }</div>
<div class="line"><span class="lineno">  392</span> </div>
<div class="line"><span class="lineno">  393</span>    graph.emplace_shared&lt;LandmarkMotionTernaryFactor&gt;(</div>
<div class="line"><span class="lineno">  394</span>        lmk_k_1_key, lmk_k_key, object_motion_key, landmark_motion_noise);</div>
<div class="line"><span class="lineno">  395</span>  }</div>
<div class="line"><span class="lineno">  396</span> </div>
<div class="line"><span class="lineno">  397</span>  <span class="keywordtype">double</span> error_before = graph.error(values);</div>
<div class="line"><span class="lineno">  398</span>  std::vector&lt;double&gt; post_errors;</div>
<div class="line"><span class="lineno">  399</span> </div>
<div class="line"><span class="lineno">  400</span>  gtsam::NonlinearFactorGraph mutable_graph = graph;</div>
<div class="line"><span class="lineno">  401</span>  gtsam::Values optimised_values = values;</div>
<div class="line"><span class="lineno">  402</span> </div>
<div class="line"><span class="lineno">  403</span>  <a class="code hl_typedef" href="namespacedyno_1_1utils.html#a2a0bf9b09c753fdfa86ae7ebb92a0746">utils::StatsCollector</a>(<span class="stringliteral">&quot;motion_solver.object_nlo_refinement_num_vars_all&quot;</span>)</div>
<div class="line"><span class="lineno">  404</span>      .<a class="code hl_function" href="classdyno_1_1utils_1_1StatsCollectorImpl.html#ab92087ce27dbec18730bf779e48d6aec">AddSample</a>(optimised_values.size());</div>
<div class="line"><span class="lineno">  405</span> </div>
<div class="line"><span class="lineno">  406</span>  gtsam::LevenbergMarquardtParams opt_params;</div>
<div class="line"><span class="lineno">  407</span>  opt_params.setMaxIterations(5);</div>
<div class="line"><span class="lineno">  408</span>  <span class="keywordflow">if</span> (VLOG_IS_ON(200))</div>
<div class="line"><span class="lineno">  409</span>    opt_params.verbosity = gtsam::NonlinearOptimizerParams::Verbosity::ERROR;</div>
<div class="line"><span class="lineno">  410</span> </div>
<div class="line"><span class="lineno">  411</span>  optimised_values = gtsam::LevenbergMarquardtOptimizer(</div>
<div class="line"><span class="lineno">  412</span>                         mutable_graph, optimised_values, opt_params)</div>
<div class="line"><span class="lineno">  413</span>                         .optimize();</div>
<div class="line"><span class="lineno">  414</span>  <span class="keywordtype">double</span> error_after = mutable_graph.error(optimised_values);</div>
<div class="line"><span class="lineno">  415</span>  <span class="comment">// post_errors.push_back(error_after);</span></div>
<div class="line"><span class="lineno">  416</span> </div>
<div class="line"><span class="lineno">  417</span>  gtsam::FactorIndices outlier_factors =</div>
<div class="line"><span class="lineno">  418</span>      factor_graph_tools::determineFactorOutliers&lt;LandmarkMotionTernaryFactor&gt;(</div>
<div class="line"><span class="lineno">  419</span>          mutable_graph, optimised_values);</div>
<div class="line"><span class="lineno">  420</span> </div>
<div class="line"><span class="lineno">  421</span>  std::set&lt;TrackletId&gt; outlier_tracks;</div>
<div class="line"><span class="lineno">  422</span>  <span class="comment">// if we have outliers, enter iteration loop</span></div>
<div class="line"><span class="lineno">  423</span>  <span class="keywordflow">if</span> (outlier_factors.size() &gt; 0u &amp;&amp; <a class="code hl_variable" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a340d76ff81e95c55de4c84b6f4f20970">params_</a>.<a class="code hl_variable" href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html#a3eaa8e3e6fd351ca67626da65b468ba3">outlier_reject</a>) {</div>
<div class="line"><span class="lineno">  424</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> itr = 0; itr &lt; 4; itr++) {</div>
<div class="line"><span class="lineno">  425</span>      <span class="comment">// currently removing factors from graph makes them nullptr</span></div>
<div class="line"><span class="lineno">  426</span>      gtsam::NonlinearFactorGraph mutable_graph_with_null = mutable_graph;</div>
<div class="line"><span class="lineno">  427</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> outlier_idx : outlier_factors) {</div>
<div class="line"><span class="lineno">  428</span>        <span class="keyword">auto</span> factor = mutable_graph_with_null.at(outlier_idx);</div>
<div class="line"><span class="lineno">  429</span>        DynamicPointSymbol point_symbol = factor-&gt;keys()[0];</div>
<div class="line"><span class="lineno">  430</span>        outlier_tracks.insert(point_symbol.trackletId());</div>
<div class="line"><span class="lineno">  431</span>        mutable_graph_with_null.remove(outlier_idx);</div>
<div class="line"><span class="lineno">  432</span>      }</div>
<div class="line"><span class="lineno">  433</span>      <span class="comment">// now iterate over graph and add factors that are not null to ensure all</span></div>
<div class="line"><span class="lineno">  434</span>      <span class="comment">// factors are ok</span></div>
<div class="line"><span class="lineno">  435</span>      mutable_graph.resize(0);</div>
<div class="line"><span class="lineno">  436</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; mutable_graph_with_null.size(); i++) {</div>
<div class="line"><span class="lineno">  437</span>        <span class="keyword">auto</span> factor = mutable_graph_with_null.at(i);</div>
<div class="line"><span class="lineno">  438</span>        <span class="keywordflow">if</span> (factor) {</div>
<div class="line"><span class="lineno">  439</span>          mutable_graph.add(factor);</div>
<div class="line"><span class="lineno">  440</span>        }</div>
<div class="line"><span class="lineno">  441</span>      }</div>
<div class="line"><span class="lineno">  442</span> </div>
<div class="line"><span class="lineno">  443</span>      values.insert(object_motion_key, initial_motion);</div>
<div class="line"><span class="lineno">  444</span>      <span class="comment">// do we use values or optimised values here?</span></div>
<div class="line"><span class="lineno">  445</span>      optimised_values = gtsam::LevenbergMarquardtOptimizer(</div>
<div class="line"><span class="lineno">  446</span>                             mutable_graph, optimised_values, opt_params)</div>
<div class="line"><span class="lineno">  447</span>                             .optimize();</div>
<div class="line"><span class="lineno">  448</span>      error_after = mutable_graph.error(optimised_values);</div>
<div class="line"><span class="lineno">  449</span>      post_errors.push_back(error_after);</div>
<div class="line"><span class="lineno">  450</span> </div>
<div class="line"><span class="lineno">  451</span>      outlier_factors = <a class="code hl_function" href="namespacedyno_1_1factor__graph__tools.html#af7b6cb76226919a10ad3cdac2ba3ac6a">factor_graph_tools::determineFactorOutliers</a>&lt;</div>
<div class="line"><span class="lineno">  452</span>          LandmarkMotionTernaryFactor&gt;(mutable_graph, optimised_values);</div>
<div class="line"><span class="lineno">  453</span> </div>
<div class="line"><span class="lineno">  454</span>      <span class="keywordflow">if</span> (outlier_factors.size() == 0) {</div>
<div class="line"><span class="lineno">  455</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  456</span>      }</div>
<div class="line"><span class="lineno">  457</span>    }</div>
<div class="line"><span class="lineno">  458</span>  }</div>
<div class="line"><span class="lineno">  459</span> </div>
<div class="line"><span class="lineno">  460</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> initial_size = graph.size();</div>
<div class="line"><span class="lineno">  461</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> inlier_size = mutable_graph.size();</div>
<div class="line"><span class="lineno">  462</span>  error_after = mutable_graph.error(optimised_values);</div>
<div class="line"><span class="lineno">  463</span> </div>
<div class="line"><span class="lineno">  464</span>  <a class="code hl_typedef" href="namespacedyno.html#a80a44a3e6e4745a2514ffdc58dbcfaac">Pose3SolverResult</a> result;</div>
<div class="line"><span class="lineno">  465</span>  result.best_result = optimised_values.at&lt;gtsam::Pose3&gt;(object_motion_key);</div>
<div class="line"><span class="lineno">  466</span>  result.outliers = <a class="code hl_typedef" href="namespacedyno.html#a7b74611da938f0d55a3b1fdb16219037">TrackletIds</a>(outlier_tracks.begin(), outlier_tracks.end());</div>
<div class="line"><span class="lineno">  467</span>  result.error_before = error_before;</div>
<div class="line"><span class="lineno">  468</span>  result.error_after = error_after;</div>
<div class="line"><span class="lineno">  469</span> </div>
<div class="line"><span class="lineno">  470</span>  <span class="comment">// naming is confusing, but we already have the outliers but we can use the</span></div>
<div class="line"><span class="lineno">  471</span>  <span class="comment">// same function to find the inliers</span></div>
<div class="line"><span class="lineno">  472</span>  <a class="code hl_function" href="namespacedyno.html#af008198dcb75012836115300a522ca86">determineOutlierIds</a>(result.outliers, tracklets, result.inliers);</div>
<div class="line"><span class="lineno">  473</span> </div>
<div class="line"><span class="lineno">  474</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> outlier_tracklet : outlier_tracks) {</div>
<div class="line"><span class="lineno">  475</span>    Feature::Ptr feature_k_1 = frame_k_1-&gt;at(outlier_tracklet);</div>
<div class="line"><span class="lineno">  476</span>    Feature::Ptr feature_k = frame_k-&gt;at(outlier_tracklet);</div>
<div class="line"><span class="lineno">  477</span> </div>
<div class="line"><span class="lineno">  478</span>    CHECK(feature_k_1-&gt;usable());</div>
<div class="line"><span class="lineno">  479</span>    CHECK(feature_k-&gt;usable());</div>
<div class="line"><span class="lineno">  480</span> </div>
<div class="line"><span class="lineno">  481</span>    feature_k-&gt;markOutlier();</div>
<div class="line"><span class="lineno">  482</span>    feature_k_1-&gt;markOutlier();</div>
<div class="line"><span class="lineno">  483</span>  }</div>
<div class="line"><span class="lineno">  484</span> </div>
<div class="line"><span class="lineno">  485</span>  <span class="comment">// number of variables after outlier removal</span></div>
<div class="line"><span class="lineno">  486</span>  <a class="code hl_typedef" href="namespacedyno_1_1utils.html#a2a0bf9b09c753fdfa86ae7ebb92a0746">utils::StatsCollector</a>(<span class="stringliteral">&quot;motion_solver.object_nlo_refinement_num_vars_inliers&quot;</span>)</div>
<div class="line"><span class="lineno">  487</span>      .<a class="code hl_function" href="classdyno_1_1utils_1_1StatsCollectorImpl.html#ab92087ce27dbec18730bf779e48d6aec">AddSample</a>(result.inliers.size());</div>
<div class="line"><span class="lineno">  488</span> </div>
<div class="line"><span class="lineno">  489</span>  <span class="comment">// LOG(INFO) &lt;&lt; &quot;Object Motion refinement - error before: &quot;</span></div>
<div class="line"><span class="lineno">  490</span>  <span class="comment">//     &lt;&lt; error_before &lt;&lt; &quot; error after: &quot; &lt;&lt; error_after</span></div>
<div class="line"><span class="lineno">  491</span>  <span class="comment">//     &lt;&lt; &quot; with initial size &quot; &lt;&lt; initial_size &lt;&lt; &quot; inlier size &quot; &lt;&lt;</span></div>
<div class="line"><span class="lineno">  492</span>  <span class="comment">//     inlier_size;</span></div>
<div class="line"><span class="lineno">  493</span> </div>
<div class="line"><span class="lineno">  494</span>  <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  495</span>}</div>
<div class="ttc" id="aclassdyno_1_1utils_1_1StatsCollectorImpl_html_ab92087ce27dbec18730bf779e48d6aec"><div class="ttname"><a href="classdyno_1_1utils_1_1StatsCollectorImpl.html#ab92087ce27dbec18730bf779e48d6aec">dyno::utils::StatsCollectorImpl::AddSample</a></div><div class="ttdeci">void AddSample(double sample) const</div><div class="ttdef"><b>Definition:</b> <a href="Statistics_8cc_source.html#l00133">Statistics.cc:133</a></div></div>
<div class="ttc" id="anamespacedyno_1_1factor__graph__tools_html_af7b6cb76226919a10ad3cdac2ba3ac6a"><div class="ttname"><a href="namespacedyno_1_1factor__graph__tools.html#af7b6cb76226919a10ad3cdac2ba3ac6a">dyno::factor_graph_tools::determineFactorOutliers</a></div><div class="ttdeci">gtsam::FactorIndices determineFactorOutliers(const gtsam::NonlinearFactorGraph &amp;graph, const gtsam::Values &amp;values, double confidence=0.99)</div><div class="ttdef"><b>Definition:</b> <a href="FactorGraphTools_8hpp_source.html#l00075">FactorGraphTools.hpp:75</a></div></div>
<div class="ttc" id="anamespacedyno_1_1utils_html_a2a0bf9b09c753fdfa86ae7ebb92a0746"><div class="ttname"><a href="namespacedyno_1_1utils.html#a2a0bf9b09c753fdfa86ae7ebb92a0746">dyno::utils::StatsCollector</a></div><div class="ttdeci">StatsCollectorImpl StatsCollector</div><div class="ttdef"><b>Definition:</b> <a href="Statistics_8hpp_source.html#l00305">Statistics.hpp:305</a></div></div>
<div class="ttc" id="anamespacedyno_html_a0b2080ebc6273ea80d2716e39ead6525"><div class="ttname"><a href="namespacedyno.html#a0b2080ebc6273ea80d2716e39ead6525">dyno::GenericProjectionFactor</a></div><div class="ttdeci">gtsam::GenericProjectionFactor&lt; gtsam::Pose3, gtsam::Point3, CalibrationType &gt; GenericProjectionFactor</div><div class="ttdef"><b>Definition:</b> <a href="BackendDefinitions_8hpp_source.html#l00202">BackendDefinitions.hpp:204</a></div></div>
<div class="ttc" id="anamespacedyno_html_a23977a9581e8b4d2b684f749ec21cba2"><div class="ttname"><a href="namespacedyno.html#a23977a9581e8b4d2b684f749ec21cba2">dyno::ObjectMotionSymbol</a></div><div class="ttdeci">gtsam::Key ObjectMotionSymbol(ObjectId object_label, FrameId frame_id)</div><div class="ttdef"><b>Definition:</b> <a href="Symbols_8hpp_source.html#l00143">Symbols.hpp:143</a></div></div>
<div class="ttc" id="anamespacedyno_html_a314d7f58c130d0aa28270309ff7500c5"><div class="ttname"><a href="namespacedyno.html#a314d7f58c130d0aa28270309ff7500c5">dyno::CameraPoseSymbol</a></div><div class="ttdeci">gtsam::Symbol CameraPoseSymbol(FrameId frame_id)</div><div class="ttdef"><b>Definition:</b> <a href="Symbols_8hpp_source.html#l00133">Symbols.hpp:133</a></div></div>
<div class="ttc" id="anamespacedyno_html_a7b74611da938f0d55a3b1fdb16219037"><div class="ttname"><a href="namespacedyno.html#a7b74611da938f0d55a3b1fdb16219037">dyno::TrackletIds</a></div><div class="ttdeci">std::vector&lt; TrackletId &gt; TrackletIds</div><div class="ttdef"><b>Definition:</b> <a href="Types_8hpp_source.html#l00083">Types.hpp:83</a></div></div>
<div class="ttc" id="anamespacedyno_html_a80a44a3e6e4745a2514ffdc58dbcfaac"><div class="ttname"><a href="namespacedyno.html#a80a44a3e6e4745a2514ffdc58dbcfaac">dyno::Pose3SolverResult</a></div><div class="ttdeci">SolverResult&lt; gtsam::Pose3 &gt; Pose3SolverResult</div><div class="ttdef"><b>Definition:</b> <a href="MotionSolver_8hpp_source.html#l00116">MotionSolver.hpp:116</a></div></div>
<div class="ttc" id="anamespacedyno_html_aaa260a8022691078c59e1ac6a4fa05b5"><div class="ttname"><a href="namespacedyno.html#aaa260a8022691078c59e1ac6a4fa05b5">dyno::Keypoint</a></div><div class="ttdeci">gtsam::Point2 Keypoint</div><div class="ttdoc">Observed optical flow vector (ordered x, y)</div><div class="ttdef"><b>Definition:</b> <a href="Types_8hpp_source.html#l00096">Types.hpp:96</a></div></div>
<div class="ttc" id="anamespacedyno_html_abd0ce4d0c7ed8fc398cc515654019802"><div class="ttname"><a href="namespacedyno.html#abd0ce4d0c7ed8fc398cc515654019802">dyno::DynamicLandmarkSymbol</a></div><div class="ttdeci">DynamicPointSymbol DynamicLandmarkSymbol(FrameId frame_id, TrackletId tracklet_id)</div><div class="ttdef"><b>Definition:</b> <a href="Symbols_8hpp_source.html#l00139">Symbols.hpp:139</a></div></div>
<div class="ttc" id="anamespacedyno_html_af008198dcb75012836115300a522ca86"><div class="ttname"><a href="namespacedyno.html#af008198dcb75012836115300a522ca86">dyno::determineOutlierIds</a></div><div class="ttdeci">void determineOutlierIds(const TrackletIds &amp;inliers, const TrackletIds &amp;tracklets, TrackletIds &amp;outliers)</div><div class="ttdoc">From a set a tracklets and a subset (of the tracklet) inliers, calculate the remaining subset of outl...</div><div class="ttdef"><b>Definition:</b> <a href="VisionTools_8cc_source.html#l00744">VisionTools.cc:744</a></div></div>
<div class="ttc" id="anamespacedyno_html_afdd174eb44901fb205371d796287378c"><div class="ttname"><a href="namespacedyno.html#afdd174eb44901fb205371d796287378c">dyno::TrackletId</a></div><div class="ttdeci">long int TrackletId</div><div class="ttdoc">Unique tracklet/landmark id, i.</div><div class="ttdef"><b>Definition:</b> <a href="Types_8hpp_source.html#l00081">Types.hpp:81</a></div></div>
<div class="ttc" id="astructdyno_1_1MotionOnlyRefinementOptimizer_1_1Params_html_a1d7dea3a8cf4c377bd9b9e6414579601"><div class="ttname"><a href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html#a1d7dea3a8cf4c377bd9b9e6414579601">dyno::MotionOnlyRefinementOptimizer::Params::k_huber</a></div><div class="ttdeci">double k_huber</div><div class="ttdef"><b>Definition:</b> <a href="MotionSolver_8hpp_source.html#l00224">MotionSolver.hpp:224</a></div></div>
<div class="ttc" id="astructdyno_1_1MotionOnlyRefinementOptimizer_1_1Params_html_a3eaa8e3e6fd351ca67626da65b468ba3"><div class="ttname"><a href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html#a3eaa8e3e6fd351ca67626da65b468ba3">dyno::MotionOnlyRefinementOptimizer::Params::outlier_reject</a></div><div class="ttdeci">bool outlier_reject</div><div class="ttdef"><b>Definition:</b> <a href="MotionSolver_8hpp_source.html#l00225">MotionSolver.hpp:225</a></div></div>
<div class="ttc" id="astructdyno_1_1MotionOnlyRefinementOptimizer_1_1Params_html_a46c4fd02a6e847138138df41578e43a4"><div class="ttname"><a href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html#a46c4fd02a6e847138138df41578e43a4">dyno::MotionOnlyRefinementOptimizer::Params::landmark_motion_sigma</a></div><div class="ttdeci">double landmark_motion_sigma</div><div class="ttdef"><b>Definition:</b> <a href="MotionSolver_8hpp_source.html#l00222">MotionSolver.hpp:222</a></div></div>
<div class="ttc" id="astructdyno_1_1MotionOnlyRefinementOptimizer_1_1Params_html_a484de3246636c520e3a865641291cc94"><div class="ttname"><a href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html#a484de3246636c520e3a865641291cc94">dyno::MotionOnlyRefinementOptimizer::Params::projection_sigma</a></div><div class="ttdeci">double projection_sigma</div><div class="ttdef"><b>Definition:</b> <a href="MotionSolver_8hpp_source.html#l00223">MotionSolver.hpp:223</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="classdyno_1_1utils_1_1StatsCollectorImpl.html#ab92087ce27dbec18730bf779e48d6aec">dyno::utils::StatsCollectorImpl::AddSample()</a>, <a class="el" href="structdyno_1_1SolverResult.html#ac780db495ed8f4f6bc1d469033e1b88f">dyno::SolverResult&lt; T &gt;::best_result</a>, <a class="el" href="namespacedyno.html#a314d7f58c130d0aa28270309ff7500c5">dyno::CameraPoseSymbol()</a>, <a class="el" href="namespacedyno_1_1factor__graph__tools.html#af7b6cb76226919a10ad3cdac2ba3ac6a">dyno::factor_graph_tools::determineFactorOutliers()</a>, <a class="el" href="namespacedyno.html#af008198dcb75012836115300a522ca86">dyno::determineOutlierIds()</a>, <a class="el" href="namespacedyno.html#abd0ce4d0c7ed8fc398cc515654019802">dyno::DynamicLandmarkSymbol()</a>, <a class="el" href="structdyno_1_1SolverResult.html#a8c86fc4c025fb11bd0ca7875b52fa968">dyno::SolverResult&lt; T &gt;::error_after</a>, <a class="el" href="structdyno_1_1SolverResult.html#a6c1465c8e7ba4ecb74854c8693af7fd4">dyno::SolverResult&lt; T &gt;::error_before</a>, <a class="el" href="structdyno_1_1SolverResult.html#a72ed8a5ed98d840f15e5e62863da2457">dyno::SolverResult&lt; T &gt;::inliers</a>, <a class="el" href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html#a1d7dea3a8cf4c377bd9b9e6414579601">dyno::MotionOnlyRefinementOptimizer::Params::k_huber</a>, <a class="el" href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html#a46c4fd02a6e847138138df41578e43a4">dyno::MotionOnlyRefinementOptimizer::Params::landmark_motion_sigma</a>, <a class="el" href="namespacedyno.html#a23977a9581e8b4d2b684f749ec21cba2">dyno::ObjectMotionSymbol()</a>, <a class="el" href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html#a3eaa8e3e6fd351ca67626da65b468ba3">dyno::MotionOnlyRefinementOptimizer::Params::outlier_reject</a>, <a class="el" href="structdyno_1_1SolverResult.html#ae673e2cd839da80eee3a46267cf4516b">dyno::SolverResult&lt; T &gt;::outliers</a>, <a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a340d76ff81e95c55de4c84b6f4f20970">params_</a>, <a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99aed53fa669f1a05cfee80463c8c94f122">PointError</a>, <a class="el" href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html#a484de3246636c520e3a865641291cc94">dyno::MotionOnlyRefinementOptimizer::Params::projection_sigma</a>, <a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99a83dddddaeb67cbe0d684911c66dc4b14">ProjectionError</a>, and <a class="el" href="classdyno_1_1DynamicPointSymbol.html#a5322b67e507483ef7ac28abe5b660b88">dyno::DynamicPointSymbol::trackletId()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classdyno_1_1MotionOnlyRefinementOptimizer_ab9ea6586ab1c0a64f008a05a38350aae_cgraph.png" border="0" usemap="#aclassdyno_1_1MotionOnlyRefinementOptimizer_ab9ea6586ab1c0a64f008a05a38350aae_cgraph" alt=""/></div>
<map name="aclassdyno_1_1MotionOnlyRefinementOptimizer_ab9ea6586ab1c0a64f008a05a38350aae_cgraph" id="aclassdyno_1_1MotionOnlyRefinementOptimizer_ab9ea6586ab1c0a64f008a05a38350aae_cgraph">
<area shape="rect" title=" " alt="" coords="5,205,217,245"/>
<area shape="rect" href="classdyno_1_1utils_1_1StatsCollectorImpl.html#ab92087ce27dbec18730bf779e48d6aec" title=" " alt="" coords="288,33,477,73"/>
<area shape="rect" href="namespacedyno.html#a314d7f58c130d0aa28270309ff7500c5" title=" " alt="" coords="286,98,479,123"/>
<area shape="rect" href="namespacedyno_1_1factor__graph__tools.html#af7b6cb76226919a10ad3cdac2ba3ac6a" title=" " alt="" coords="269,148,496,188"/>
<area shape="rect" href="namespacedyno.html#af008198dcb75012836115300a522ca86" title="From a set a tracklets and a subset (of the tracklet) inliers, calculate the remaining subset of outl..." alt="" coords="287,213,479,238"/>
<area shape="rect" href="namespacedyno.html#abd0ce4d0c7ed8fc398cc515654019802" title=" " alt="" coords="265,262,500,287"/>
<area shape="rect" href="namespacedyno.html#a23977a9581e8b4d2b684f749ec21cba2" title=" " alt="" coords="283,311,482,337"/>
<area shape="rect" href="classdyno_1_1DynamicPointSymbol.html#a5322b67e507483ef7ac28abe5b660b88" title=" " alt="" coords="281,361,484,401"/>
<area shape="rect" href="classdyno_1_1utils_1_1Statistics.html#a1c18a39943c66b2bd4b6a788ed2c06be" title=" " alt="" coords="569,5,727,45"/>
<area shape="rect" href="classdyno_1_1utils_1_1Statistics.html#a755d6b65c1cbd3b81bf3b431fd6e8bfd" title=" " alt="" coords="796,35,955,75"/>
<area shape="rect" href="namespacedyno.html#a45aa2da5e284a5b1014c7d698ae91afc" title="Compute the quantile function of the Chi&#45;Squared distribution." alt="" coords="548,155,748,181"/>
<area shape="rect" href="namespacedyno.html#a362927fda6438780973f55111b77455c" title=" " alt="" coords="612,311,684,337"/>
</map>
</div>

</div>
</div>
<a id="a6a892ae86966052c856c312099c68462" name="a6a892ae86966052c856c312099c68462"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a892ae86966052c856c312099c68462">&#9670;&#160;</a></span>optimizeAndUpdate()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename CALIBRATION &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacedyno.html#a80a44a3e6e4745a2514ffdc58dbcfaac">Pose3SolverResult</a> dyno::MotionOnlyRefinementOptimizer::optimizeAndUpdate </td>
          <td>(</td>
          <td class="paramtype">Frame::Ptr&#160;</td>
          <td class="paramname"><em>frame_k_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Frame::Ptr&#160;</td>
          <td class="paramname"><em>frame_k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacedyno.html#a7b74611da938f0d55a3b1fdb16219037">TrackletIds</a> &amp;&#160;</td>
          <td class="paramname"><em>tracklets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacedyno.html#a38bb86e4154b86428b8d133be03fb2b5">ObjectId</a>&#160;</td>
          <td class="paramname"><em>object_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const gtsam::Pose3 &amp;&#160;</td>
          <td class="paramname"><em>initial_motion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99">RefinementSolver</a> &amp;&#160;</td>
          <td class="paramname"><em>solver</em> = <code><a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#a62fb52bd592e738694e8851bf8e0fd99a83dddddaeb67cbe0d684911c66dc4b14">RefinementSolver::ProjectionError</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>currently no outlier rejection</p>

<p class="definition">Definition at line <a class="el" href="MotionSolver-inl_8hpp_source.html#l00498">498</a> of file <a class="el" href="MotionSolver-inl_8hpp_source.html">MotionSolver-inl.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  501</span>                                                                            {</div>
<div class="line"><span class="lineno">  503</span>  <span class="keyword">auto</span> result = this-&gt;optimize&lt;CALIBRATION&gt;(frame_k_1, frame_k, tracklets,</div>
<div class="line"><span class="lineno">  504</span>                                            object_id, initial_motion, solver);</div>
<div class="line"><span class="lineno">  505</span> </div>
<div class="line"><span class="lineno">  506</span>  <span class="comment">// TODO: update frame with outliers</span></div>
<div class="line"><span class="lineno">  507</span>  <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  508</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="classdyno_1_1ObjectMotionSovlerF2F.html#a432924457f5c458282c63002648b99a9">dyno::ObjectMotionSovlerF2F::geometricOutlierRejection3d2d()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classdyno_1_1MotionOnlyRefinementOptimizer_a6a892ae86966052c856c312099c68462_icgraph.png" border="0" usemap="#aclassdyno_1_1MotionOnlyRefinementOptimizer_a6a892ae86966052c856c312099c68462_icgraph" alt=""/></div>
<map name="aclassdyno_1_1MotionOnlyRefinementOptimizer_a6a892ae86966052c856c312099c68462_icgraph" id="aclassdyno_1_1MotionOnlyRefinementOptimizer_a6a892ae86966052c856c312099c68462_icgraph">
<area shape="rect" title=" " alt="" coords="548,5,771,45"/>
<area shape="rect" href="classdyno_1_1ObjectMotionSovlerF2F.html#a432924457f5c458282c63002648b99a9" title=" " alt="" coords="244,5,500,45"/>
<area shape="rect" href="classdyno_1_1ObjectMotionSovlerF2F.html#a5ba48941f5b2cf548249b7efee399ed4" title=" " alt="" coords="5,5,196,45"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a340d76ff81e95c55de4c84b6f4f20970" name="a340d76ff81e95c55de4c84b6f4f20970"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a340d76ff81e95c55de4c84b6f4f20970">&#9670;&#160;</a></span>params_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdyno_1_1MotionOnlyRefinementOptimizer_1_1Params.html">Params</a> dyno::MotionOnlyRefinementOptimizer::params_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MotionSolver_8hpp_source.html#l00245">245</a> of file <a class="el" href="MotionSolver_8hpp_source.html">MotionSolver.hpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="classdyno_1_1MotionOnlyRefinementOptimizer.html#ab9ea6586ab1c0a64f008a05a38350aae">optimize()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>dynosam/include/dynosam/frontend/vision/<a class="el" href="MotionSolver_8hpp_source.html">MotionSolver.hpp</a></li>
<li>dynosam/include/dynosam/frontend/vision/<a class="el" href="MotionSolver-inl_8hpp_source.html">MotionSolver-inl.hpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
